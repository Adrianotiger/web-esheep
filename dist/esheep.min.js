"use strict";var _createClass=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var VERSION="0.8.0",ACTIVATE_DEBUG=!1,DEFAULT_XML="https://adrianotiger.github.io/web-esheep/pets/original.xml",COLLISION_WITH=["div","hr"],eSheep=function(){function eSheep(e,t){_classCallCheck(this,eSheep),this.userOptions=e||{allowPets:"none",allowPopup:"yes"},this.userOptions.allowPopup||(this.userOptions.allowPopup="yes"),this.userOptions.allowPets||(this.userOptions.allowPets="none"),this.animationFile=DEFAULT_XML,this.id=Date.now()+Math.random(),this.DOMdiv=document.createElement("div"),this.DOMdiv.setAttribute("id",this.id),this.DOMimg=document.createElement("img"),this.DOMinfo=document.createElement("div"),this.parser=new DOMParser,this.xmlDoc=null,this.prepareToDie=!1,this.isChild=null!=t,this.tilesX=1,this.tilesY=1,this.imageW=1,this.imageH=1,this.imageX=1,this.imageY=1,this.flipped=!1,this.dragging=!1,this.infobox=!1,this.animationId=0,this.animationStep=0,this.animationNode=null,this.sprite=new Image,this.HTMLelement=null,this.randS=100*Math.random(),this.screenW=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,this.screenH=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight}return _createClass(eSheep,[{key:"Start",value:function(e){void 0!==e&&null!=e&&(this.animationFile=e);var t=new XMLHttpRequest,i=this;t.open("GET",this.animationFile,!0),t.addEventListener("readystatechange",function(){4==this.readyState&&(200==this.status?i._parseXML(this.responseText):console.error("XML not available:"+this.statusText+"\n"+this.responseText))}),t.send(null)}},{key:"remove",value:function(){var e=this;this.prepareToDie=!0,this.DOMinfo.Hide(),setTimeout(function(){e.DOMdiv=e.DOMimg=e.DOMinfo=null,document.getElementById(e.id).outerHTML=""},500)}},{key:"_parseXML",value:function(e){var n=this;this.xmlDoc=this.parser.parseFromString(e,"text/xml");var t=this.xmlDoc.getElementsByTagName("image")[0];this.tilesX=t.getElementsByTagName("tilesx")[0].textContent,this.tilesY=t.getElementsByTagName("tilesy")[0].textContent,this.sprite.addEventListener("load",function(){ACTIVATE_DEBUG&&console.log("Sprite image loaded");var e="width:"+n.sprite.width+"px;height:"+n.sprite.height+"px;position:absolute;top:0px;left:0px;max-width: none;";n.DOMimg.setAttribute("style",e),n.DOMimg.addEventListener("dragstart",function(e){return e.preventDefault(),!1}),n.imageW=n.sprite.width/n.tilesX,n.imageH=n.sprite.height/n.tilesY,e="width:"+n.imageW+"px;height:"+n.imageH+"px;position:fixed;top:"+n.imageY+"px;left:"+n.imageX+"px;transform:rotatey(0deg);cursor:move;z-index:2000;overflow:hidden;",n.DOMdiv.setAttribute("style",e),n.DOMdiv.appendChild(n.DOMimg),n.isChild?n._spawnChild():n._spawnESheep()}),this.sprite.src="data:image/png;base64,"+t.getElementsByTagName("png")[0].textContent,this.DOMimg.setAttribute("src",this.sprite.src),this.DOMdiv.addEventListener("mousemove",function(e){if(!n.dragging&&1==e.buttons&&0==e.button){n.dragging=!0,n.HTMLelement=null;for(var t=n.xmlDoc.getElementsByTagName("animations")[0].getElementsByTagName("animation"),i=0;i<t.length;i++)if("drag"==t[i].getElementsByTagName("name")[0].textContent){n.animationId=t[i].getAttribute("id"),n.animationStep=0,n.animationNode=t[i];break}}}),document.body.addEventListener("mousemove",function(e){n.dragging&&(n.imageX=parseInt(e.clientX)-n.imageW/2,n.imageY=parseInt(e.clientY)-n.imageH/2,n.DOMdiv.style.left=n.imageX+"px",n.DOMdiv.style.top=n.imageY+"px",n.DOMinfo.style.left=parseInt(n.imageX+n.imageW/2)+"px",n.DOMinfo.style.top=n.imageY+"px")}),document.body.addEventListener("resize",function(){n.screenW=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,n.screenH=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,n.imageY+n.imageH>n.screenH&&(n.imageY=n.screenH-n.imageH,n.DOMdiv.style.top=n.imageY+"px"),n.imageX+n.imageW>n.screenW&&(n.imageX=n.screenW-n.imageW,n.DOMdiv.style.left=n.imageX+"px")}),this.DOMdiv.addEventListener("contextmenu",function(e){return e.preventDefault(),!1}),this.DOMdiv.addEventListener("mouseup",function(e){n.dragging?n.dragging=!1:n.infobox?(n.DOMinfo.Hide(),n.infobox=!1):"yes"===n.userOptions.allowPopup&&(n.DOMinfo.style.left=Math.min(n.screenW-n.imageW,Math.max(n.imageW,parseInt(n.imageX+n.imageW/2)))+"px",n.DOMinfo.style.top=parseInt(n.imageY)+"px",n.DOMinfo.Show(),n.infobox=!0)}),this.DOMinfo.addEventListener("mouseup",function(e){n.DOMinfo.Hide(),n.infobox=!1});this.DOMinfo.setAttribute("style","width:200px;height:100px;transform:translate(-50%, -50%) scale(0.1);position:fixed;top:100px;left:10px;display:none;border-width:2px;border-radius:5px;border-style:ridge;border-color:#0000ab;text-align:center;text-shadow: 1px 1px 3px #ffff88;box-shadow: 3px 3px 10px #888888;color:black;opacity:0.9;z-index:9999;overflow:auto;transition:transform 0.3s ease;background: linear-gradient(to bottom right, rgba(128,128,255,0.7), rgba(200,200,255,0.4));");var i=this.xmlDoc.getElementsByTagName("header")[0],a=document.createElement("b").appendChild(document.createTextNode(i.getElementsByTagName("title")[0].textContent)),s=document.createElement("sup"),o=document.createElement("a"),r=document.createElement("p");s.appendChild(document.createTextNode("App v."+VERSION)),s.appendChild(document.createElement("br")),s.appendChild(document.createTextNode("Pet v."+i.getElementsByTagName("version")[0].textContent)),s.setAttribute("style","float:right;text-align:right;"),o.appendChild(document.createTextNode("üè†")),o.setAttribute("href","https://github.com/Adrianotiger/web-esheep"),o.setAttribute("target","_blank"),o.setAttribute("style","float:left"),r.appendChild(document.createTextNode(i.getElementsByTagName("info")[0].textContent)),r.setAttribute("style","font-size:"+(100-parseInt(i.getElementsByTagName("info")[0].textContent.length/10))+"%;"),this.DOMinfo.appendChild(s),this.DOMinfo.appendChild(o),"none"!==this.userOptions.allowPets&&((o=document.createElement("a")).appendChild(document.createTextNode("‚öô")),o.setAttribute("href","javascript:;"),o.setAttribute("style","float:left"),this.DOMinfo.appendChild(o),setTimeout(function(){n._loadPetList(o)},100)),this.DOMinfo.appendChild(a),this.DOMinfo.appendChild(document.createElement("br")),this.DOMinfo.appendChild(document.createElement("hr")),this.DOMinfo.appendChild(r),document.body.appendChild(this.DOMinfo),document.body.appendChild(this.DOMdiv),this.DOMinfo.Show=function(){n.DOMinfo.style.display="block",n.DOMinfo.style.transform="translate(-50%, -100%) scale(1.0)"},this.DOMinfo.Hide=function(){n.DOMinfo.style.transform="translate(-50%, -50%) scale(0.1)",setTimeout(function(){n.DOMinfo.style.display="none"},300)}}},{key:"_setPosition",value:function(e,t,i){this.DOMdiv&&(i?(this.imageX=parseInt(e),this.imageY=parseInt(t)):(this.imageX=parseInt(this.imageX)+parseInt(e),this.imageY=parseInt(this.imageY)+parseInt(t)),this.DOMdiv.style.left=this.imageX+"px",this.DOMdiv.style.top=this.imageY+"px")}},{key:"_spawnESheep",value:function(){for(var e=this.xmlDoc.getElementsByTagName("spawns")[0].getElementsByTagName("spawn"),t=0,i=0;i<e.length;i++)t+=parseInt(e[0].getAttribute("probability"));var n=Math.random()*t;for(i=t=0;i<e.length;i++)if(n<=(t+=parseInt(e[i].getAttribute("probability")))||i==e.length-1){this._setPosition(this._parseKeyWords(e[i].getElementsByTagName("x")[0].textContent),this._parseKeyWords(e[i].getElementsByTagName("y")[0].textContent),!0),ACTIVATE_DEBUG&&console.log("Spawn: "+this.imageX+", "+this.imageY),this.animationId=e[i].getElementsByTagName("next")[0].textContent,this.animationStep=0;for(var a=this.xmlDoc.getElementsByTagName("animations")[0].getElementsByTagName("animation"),s=0;s<a.length;s++)if(a[s].getAttribute("id")==this.animationId){this.animationNode=a[s];a=this.xmlDoc.getElementsByTagName("childs")[0].getElementsByTagName("child");for(var o=0;o<a.length;o++)if(a[o].getAttribute("animationid")==this.animationId){ACTIVATE_DEBUG&&console.log("Child from Spawn");var r=new eSheep(null,!0);r.animationId=a[o].getElementsByTagName("next")[0].textContent;var m=a[o].getElementsByTagName("x")[0].textContent,l=a[o].getElementsByTagName("y")[0].textContent;r._setPosition(this._parseKeyWords(m),this._parseKeyWords(l),!0),r.Start(this.animationFile);break}break}break}this._nextESheepStep()}},{key:"_spawnChild",value:function(){for(var e=this.xmlDoc.getElementsByTagName("animations")[0].getElementsByTagName("animation"),t=0;t<e.length;t++)if(e[t].getAttribute("id")==this.animationId){this.animationNode=e[t];break}this._nextESheepStep()}},{key:"_parseKeyWords",value:function _parseKeyWords(value){value=value.replace(/screenW/g,this.screenW),value=value.replace(/screenH/g,this.screenH),value=value.replace(/areaW/g,this.screenH),value=value.replace(/areaH/g,this.screenH),value=value.replace(/imageW/g,this.imageW),value=value.replace(/imageH/g,this.imageH),value=value.replace(/random/g,100*Math.random()),value=value.replace(/randS/g,this.randS),value=value.replace(/imageX/g,this.imageX),value=value.replace(/imageY/g,this.imageY);var ret=0;try{ret=eval(value)}catch(e){console.error("Unable to parse this position: \n'"+value+"'\n Error message: \n"+e.message)}return ret}},{key:"_getNextRandomNode",value:function(e){var t=e.getElementsByTagName("next"),i=this.xmlDoc.getElementsByTagName("animations")[0].getElementsByTagName("animation"),n=0,a=!1;if(0==t.length)return this.isChild?(ACTIVATE_DEBUG&&console.log("Remove child"),document.body.removeChild(this.DOMinfo),document.body.removeChild(this.DOMdiv)):this._spawnESheep(),!1;for(var s=0;s<t.length;s++)n+=parseInt(t[s].getAttribute("probability"));var o=Math.random()*n,r=0;for(s=n=0;s<t.length;s++)if(o<=(n+=parseInt(t[s].getAttribute("probability")))){r=s;break}for(s=0;s<i.length;s++)if(i[s].getAttribute("id")==t[r].textContent){this.animationId=i[s].getAttribute("id"),this.animationStep=0,this.animationNode=i[s],a=!0;break}if(a){i=this.xmlDoc.getElementsByTagName("childs")[0].getElementsByTagName("child");for(s=0;s<i.length;s++)if(i[s].getAttribute("animationid")==this.animationId){ACTIVATE_DEBUG&&console.log("Child from Animation");var m=new eSheep(null,!0);m.animationId=i[s].getElementsByTagName("next")[0].textContent;var l=i[s].getElementsByTagName("x")[0].textContent,h=i[s].getElementsByTagName("y")[0].textContent;m._setPosition(this._parseKeyWords(l),this._parseKeyWords(h),!0),m.Start(this.animationFile);break}}return a}},{key:"_checkOverlapping",value:function(){var e,t=this.imageX,i=this.imageY+this.imageH,n=20;for(var a in this.HTMLelement&&(n=5),COLLISION_WITH)for(var s=document.body.getElementsByTagName(COLLISION_WITH[a]),o=0;o<s.length;o++)if(i>(e=s[o].getBoundingClientRect()).top-2&&i<e.top+n&&t>e.left&&t<e.right-this.imageW){var r=window.getComputedStyle(s[o]);if(""!=r.borderTopStyle&&"none"!=r.borderTopStyle&&"none"!=r.display)return s[o]}return!1}},{key:"_getNodeValue",value:function(e,t,i){if(this.animationNode&&this.animationNode.getElementsByTagName(e)){if(this.animationNode.getElementsByTagName(e)[0].getElementsByTagName(t)[0]){var n=this.animationNode.getElementsByTagName(e)[0].getElementsByTagName(t)[0].textContent;return this._parseKeyWords(n)}return i}}},{key:"_nextESheepStep",value:function(){if(!this.prepareToDie){var e,t=this._getNodeValue("start","x",0),i=this._getNodeValue("start","y",0),n=(this._getNodeValue("start","offsety",0),this._getNodeValue("start","opacity",1),this._getNodeValue("start","interval",1e3)),a=this._getNodeValue("end","x",0),s=this._getNodeValue("end","y",0),o=(this._getNodeValue("end","offsety",0),this._getNodeValue("end","interval",1),this._getNodeValue("end","interval",1e3)),r=this._parseKeyWords(this.animationNode.getElementsByTagName("sequence")[0].getAttribute("repeat")),m=this.animationNode.getElementsByTagName("sequence")[0].getAttribute("repeatfrom"),l=this.animationNode.getElementsByTagName("gravity"),h=this.animationNode.getElementsByTagName("border"),g=this.animationNode.getElementsByTagName("frame").length+(this.animationNode.getElementsByTagName("frame").length-m)*r;if(e=this.animationStep<this.animationNode.getElementsByTagName("frame").length?this.animationNode.getElementsByTagName("frame")[this.animationStep].textContent:0==m?this.animationNode.getElementsByTagName("frame")[this.animationStep%this.animationNode.getElementsByTagName("frame").length].textContent:this.animationNode.getElementsByTagName("frame")[parseInt(m)+parseInt((this.animationStep-m)%(this.animationNode.getElementsByTagName("frame").length-m))].textContent,this.DOMimg.style.left=-this.imageW*(e%this.tilesX)+"px",this.DOMimg.style.top=-this.imageH*parseInt(e/this.tilesX)+"px",this.dragging||this.infobox)return this.animationStep++,void setTimeout(this._nextESheepStep.bind(this),50);if(this.flipped&&(t=-t,a=-a),0==this.animationStep?this._setPosition(t,i,!1):this._setPosition(parseInt(t)+parseInt((a-t)*this.animationStep/g),parseInt(i)+parseInt((s-i)*this.animationStep/g),!1),this.animationStep++,this.animationStep>=g){if(this.animationNode.getElementsByTagName("action")[0])switch(this.animationNode.getElementsByTagName("action")[0].textContent){case"flip":"rotateY(0deg)"==this.DOMdiv.style.transform?(this.DOMdiv.style.transform="rotateY(180deg)",this.flipped=!0):(this.DOMdiv.style.transform="rotateY(0deg)",this.flipped=!1)}if(!this._getNextRandomNode(this.animationNode.getElementsByTagName("sequence")[0]))return}var d=!1;if(!(h&&h[0]&&h[0].getElementsByTagName("next")&&(a<0&&this.imageX<0?d=!(this.imageX=0):0<a&&this.imageX>this.screenW-this.imageW?(this.imageX=this.screenW-this.imageW,this.DOMdiv.style.left=parseInt(this.imageX)+"px",d=!0):s<0&&this.imageY<0?d=!(this.imageY=0):0<s&&this.imageY>this.screenH-this.imageH?(this.imageY=this.screenH-this.imageH,d=!0):0<s?this._checkOverlapping()&&this.imageY>this.imageH&&(this.HTMLelement=this._checkOverlapping(),this.imageY=Math.ceil(this.HTMLelement.getBoundingClientRect().top)-this.imageH,d=!0):this.HTMLelement&&(this._checkOverlapping()||(this.imageY+this.imageH>this.HTMLelement.getBoundingClientRect().top+3||this.imageY+this.imageH<this.HTMLelement.getBoundingClientRect().top-3?this.HTMLelement=null:(this.imageX<this.HTMLelement.getBoundingClientRect().left?this.imageX=parseInt(this.imageX+3):this.imageX=parseInt(this.imageX-3),d=!0),this.DOMdiv.style.left=parseInt(this.imageX)+"px")),d&&!this._getNextRandomNode(h[0]))||!d&&l&&l[0]&&l[0].getElementsByTagName("next")&&this.imageY<this.screenH-this.imageH-2&&(null==this.HTMLelement?d=!0:this._checkOverlapping()||(d=!0,this.HTMLelement=null),d&&!this._getNextRandomNode(l[0]))))return!d&&(this.imageX<-this.imageW&&a<0||this.imageX>this.screenW&&0<a||this.imageY<-this.imageH&&i<0||this.imageY>this.screenH&&0<s)?(d=!0,void(this.isChild||this._spawnESheep())):void setTimeout(this._nextESheepStep.bind(this),parseInt(n)+parseInt((o-n)*this.animationStep/g))}}},{key:"_loadPetList",value:function(o){var r=this;fetch("https://adrianotiger.github.io/web-esheep/pets/pets.json",{credentials:"same-origin",cache:"force-cache"}).then(function(e){return e.json()}).then(function(s){console.log(s),s.pets&&o.addEventListener("mouseup",function(e){e.preventDefault(),e.stopPropagation();var t=document.createElement("div");t.setAttribute("style","position:absolute;left:0px;top:20px;width:183px;height:100%;min-height:80px;background:linear-gradient(to bottom, #8080ff, #3030a1);color:yellow;"),o.parentNode.appendChild(t);var i=function(e){(a=document.createElement("b")).setAttribute("style","cursor:pointer;display:block;"),a.appendChild(document.createTextNode(s.pets[e].name)),a.addEventListener("click",function(){new eSheep(r.userOptions).Start("https://adrianotiger.github.io/web-esheep/pets/"+s.pets[e].file),r.remove()}),t.appendChild(a)};for(var n in s.pets){var a;i(n)}t.addEventListener("click",function(e){o.parentNode.removeChild(t)})})})}}]),eSheep}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVzaGVlcC5taW4uanMiXSwibmFtZXMiOlsiX2NyZWF0ZUNsYXNzIiwiZGVmaW5lUHJvcGVydGllcyIsInRhcmdldCIsInByb3BzIiwiaSIsImxlbmd0aCIsImRlc2NyaXB0b3IiLCJlbnVtZXJhYmxlIiwiY29uZmlndXJhYmxlIiwid3JpdGFibGUiLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImtleSIsIkNvbnN0cnVjdG9yIiwicHJvdG9Qcm9wcyIsInN0YXRpY1Byb3BzIiwicHJvdG90eXBlIiwiX2NsYXNzQ2FsbENoZWNrIiwiaW5zdGFuY2UiLCJUeXBlRXJyb3IiLCJWRVJTSU9OIiwiQUNUSVZBVEVfREVCVUciLCJERUZBVUxUX1hNTCIsIkNPTExJU0lPTl9XSVRIIiwiZVNoZWVwIiwib3B0aW9ucyIsImlzQ2hpbGQiLCJ0aGlzIiwidXNlck9wdGlvbnMiLCJhbGxvd1BldHMiLCJhbGxvd1BvcHVwIiwiYW5pbWF0aW9uRmlsZSIsImlkIiwiRGF0ZSIsIm5vdyIsIk1hdGgiLCJyYW5kb20iLCJET01kaXYiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJzZXRBdHRyaWJ1dGUiLCJET01pbWciLCJET01pbmZvIiwicGFyc2VyIiwiRE9NUGFyc2VyIiwieG1sRG9jIiwicHJlcGFyZVRvRGllIiwidGlsZXNYIiwidGlsZXNZIiwiaW1hZ2VXIiwiaW1hZ2VIIiwiaW1hZ2VYIiwiaW1hZ2VZIiwiZmxpcHBlZCIsImRyYWdnaW5nIiwiaW5mb2JveCIsImFuaW1hdGlvbklkIiwiYW5pbWF0aW9uU3RlcCIsImFuaW1hdGlvbk5vZGUiLCJzcHJpdGUiLCJJbWFnZSIsIkhUTUxlbGVtZW50IiwicmFuZFMiLCJzY3JlZW5XIiwid2luZG93IiwiaW5uZXJXaWR0aCIsImRvY3VtZW50RWxlbWVudCIsImNsaWVudFdpZHRoIiwiYm9keSIsInNjcmVlbkgiLCJpbm5lckhlaWdodCIsImNsaWVudEhlaWdodCIsInZhbHVlIiwiYW5pbWF0aW9uIiwiYWpheCIsIlhNTEh0dHBSZXF1ZXN0Iiwic2hlZXBDbGFzcyIsIm9wZW4iLCJhZGRFdmVudExpc3RlbmVyIiwicmVhZHlTdGF0ZSIsInN0YXR1cyIsIl9wYXJzZVhNTCIsInJlc3BvbnNlVGV4dCIsImNvbnNvbGUiLCJlcnJvciIsInN0YXR1c1RleHQiLCJzZW5kIiwiX3RoaXMiLCJIaWRlIiwic2V0VGltZW91dCIsImdldEVsZW1lbnRCeUlkIiwib3V0ZXJIVE1MIiwidGV4dCIsIl90aGlzMiIsInBhcnNlRnJvbVN0cmluZyIsImltYWdlIiwiZ2V0RWxlbWVudHNCeVRhZ05hbWUiLCJ0ZXh0Q29udGVudCIsImxvZyIsImF0dHJpYnV0ZSIsIndpZHRoIiwiaGVpZ2h0IiwiZSIsInByZXZlbnREZWZhdWx0IiwiYXBwZW5kQ2hpbGQiLCJfc3Bhd25DaGlsZCIsIl9zcGF3bkVTaGVlcCIsInNyYyIsImJ1dHRvbnMiLCJidXR0b24iLCJjaGlsZHMiLCJrIiwiZ2V0QXR0cmlidXRlIiwicGFyc2VJbnQiLCJjbGllbnRYIiwiY2xpZW50WSIsInN0eWxlIiwibGVmdCIsInRvcCIsIm1pbiIsIm1heCIsIlNob3ciLCJoZWFkZXJOb2RlIiwiaHRtbFQiLCJjcmVhdGVUZXh0Tm9kZSIsImh0bWxWIiwiaHRtbEwiLCJodG1sUCIsIl9sb2FkUGV0TGlzdCIsImRpc3BsYXkiLCJ0cmFuc2Zvcm0iLCJ4IiwieSIsImFic29sdXRlIiwic3Bhd25zIiwicHJvYiIsInJhbmQiLCJfc2V0UG9zaXRpb24iLCJfcGFyc2VLZXlXb3JkcyIsImoiLCJlU2hlZXBDaGlsZCIsIlN0YXJ0IiwiX25leHRFU2hlZXBTdGVwIiwicmVwbGFjZSIsInJldCIsImV2YWwiLCJlcnIiLCJtZXNzYWdlIiwicGFyZW50Tm9kZSIsImJhc2VOb2RlIiwibm9kZUZvdW5kIiwicmVtb3ZlQ2hpbGQiLCJpbmRleCIsInJlY3QiLCJtYXJnaW4iLCJlbHMiLCJnZXRCb3VuZGluZ0NsaWVudFJlY3QiLCJyaWdodCIsImdldENvbXB1dGVkU3R5bGUiLCJib3JkZXJUb3BTdHlsZSIsIm5vZGVOYW1lIiwidmFsdWVOYW1lIiwiZGVmYXVsdFZhbHVlIiwieDEiLCJfZ2V0Tm9kZVZhbHVlIiwieTEiLCJkZWwxIiwieDIiLCJ5MiIsImRlbDIiLCJyZXBlYXQiLCJyZXBlYXRmcm9tIiwiZ3Jhdml0eSIsImJvcmRlciIsInN0ZXBzIiwiYmluZCIsIl9nZXROZXh0UmFuZG9tTm9kZSIsInNldE5leHQiLCJfY2hlY2tPdmVybGFwcGluZyIsImNlaWwiLCJlbGVtZW50IiwiX3RoaXMzIiwiZmV0Y2giLCJjcmVkZW50aWFscyIsImNhY2hlIiwidGhlbiIsInJlc3BvbnNlIiwianNvbiIsInBldHMiLCJzdG9wUHJvcGFnYXRpb24iLCJkaXYiLCJfbG9vcCIsInBldCIsIm5hbWUiLCJmaWxlIiwicmVtb3ZlIl0sIm1hcHBpbmdzIjoiQUFBQSxhQUVBLElBQUlBLGFBQWUsV0FBYyxTQUFTQyxFQUFpQkMsRUFBUUMsR0FBUyxJQUFLLElBQUlDLEVBQUksRUFBR0EsRUFBSUQsRUFBTUUsT0FBUUQsSUFBSyxDQUFFLElBQUlFLEVBQWFILEVBQU1DLEdBQUlFLEVBQVdDLFdBQWFELEVBQVdDLGFBQWMsRUFBT0QsRUFBV0UsY0FBZSxFQUFVLFVBQVdGLElBQVlBLEVBQVdHLFVBQVcsR0FBTUMsT0FBT0MsZUFBZVQsRUFBUUksRUFBV00sSUFBS04sSUFBaUIsT0FBTyxTQUFVTyxFQUFhQyxFQUFZQyxHQUFpSixPQUE5SEQsR0FBWWIsRUFBaUJZLEVBQVlHLFVBQVdGLEdBQWlCQyxHQUFhZCxFQUFpQlksRUFBYUUsR0FBcUJGLEdBQTdnQixHQUVuQixTQUFTSSxnQkFBZ0JDLEVBQVVMLEdBQWUsS0FBTUssYUFBb0JMLEdBQWdCLE1BQU0sSUFBSU0sVUFBVSxxQ0EwRGhILElBQUlDLFFBQVUsUUFDVkMsZ0JBQWlCLEVBQ2pCQyxZQUFjLDhEQUNkQyxlQUFpQixDQUFDLE1BQU8sTUFRekJDLE9BQVMsV0FLWCxTQUFTQSxPQUFPQyxFQUFTQyxHQUN2QlQsZ0JBQWdCVSxLQUFNSCxRQUV0QkcsS0FBS0MsWUFB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QUFTLGlDQUMxQndKLEVBQUl4RixZQUFZbEUsU0FBU3NGLGVBQWUrRCxFQUFLQyxLQUFLN0UsR0FBR2tGLE9BQ3JERCxFQUFJbEgsaUJBQWlCLFFBQVMsV0FDcEIsSUFBSXRELE9BQU82SixFQUFPekosYUFDeEJpSCxNQUFNLGtEQUFvRDhDLEVBQUtDLEtBQUs3RSxHQUFHbUYsTUFDekViLEVBQU9jLFdBRVRMLEVBQUl0RixZQUFZd0YsSUFHbEIsSUFBSyxJQUFJakYsS0FBSzRFLEVBQUtDLEtBQU0sQ0FDdkIsSUFBSUksRUFFSkQsRUFBTWhGLEdBR1IrRSxFQUFJaEgsaUJBQWlCLFFBQVMsU0FBVXdCLEdBQ3RDOEUsRUFBUWhDLFdBQVdHLFlBQVl1QyxhQVFwQ3RLLE9BdnFCSSIsImZpbGUiOiJlc2hlZXAubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbnZhciBfY3JlYXRlQ2xhc3MgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoXCJ2YWx1ZVwiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KCk7XG5cbmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvblwiKTsgfSB9XG5cbi8qXG4gKiBQcm9qZWN0OlxuICogICAgICAgICAgICAgICAgZVNoZWVwIC0gV2VicGFnZVxuICpcbiAqIERhdGU6XG4gKiAgICAgICAgICAgICAgICAwNC5hcHJpbCAyMDE4XG4gKlxuICogQXV0aG9yOlxuICogICAgICAgICAgICAgICAgQWRyaWFubyBQZXRydWNjaSAoaHR0cDovL2VzaGVlcC5wZXRydWNjaS5jaClcbiAqXG4gKiBWZXJzaW9uOiAgICAgICAwLjguMFxuICpcbiAqIEludHJvZHVjdGlvbjpcbiAqICAgICAgICAgICAgICAgIEFzIFwid3JhcHBlclwiIGZvciB0aGUgT3BlblNvdXJjZSBDIyBwcm9qZWN0XG4gKiAgICAgICAgICAgICAgICAoc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9BZHJpYW5vdGlnZXIvZGVza3RvcFBldCksXG4gKiAgICAgICAgICAgICAgICB0aGlzIGphdmFzY3JpcHQgXCJjbGFzc1wiIHdhcyB3cml0dGVuIHRvIGdldCB0aGUgYW5pbWF0aW9ucyBhbHNvIGluc2lkZSB5b3VyXG4gKiAgICAgICAgICAgICAgICB3ZWJwYWdlLiBJdCBkb2Vzbid0IHdvcmsgbGlrZSB0aGUgV2luZG93cyB2ZXJzaW9uLCBidXQgc2hvdyBtdWNoIGFuaW1hdGlvbnMgZnJvbSBpdC5cbiAqXG4gKiBEZXNjcmlwdGlvbjpcbiAqICAgICAgICAgICAgICAgIEFkZCBhIHdhbGtpbmcgcGV0IChzaGVlcCB0byB5b3VyIGhvbWUgcGFnZSkgd2l0aCBqdXN0IGEgZmV3IGxpbmVzIG9mIGNvZGUhXG4gKiAgICAgICAgICAgICAgICBXaWxsIGFkZCBhIGxvdmVseSBzaGVlcCAoc3RyYXkgc2hlZXApIGFuZCB0aGlzIHdpbGwgd2FsayBhcm91bmQgeW91ciBwYWdlIGFuZCBvdmVyXG4gKiAgICAgICAgICAgICAgICBhbGwgPGhyPnMgYW5kIDxkaXY+cyB3aXRoIGEgYm9yZGVyLiBZb3UgY2FuIGFsc28gc2VsZWN0IGFub3RoZXIgYW5pbWF0aW9uLCB1c2luZyB5b3VyXG4gKiAgICAgICAgICAgICAgICBwZXJzb25hbCBYTUwgZmlsZSBvciBvbmUgZnJvbSB0aGUgZGF0YWJhc2UuXG4gKlxuICogSG93IHRvIHVzZTpcbiAqICAgICAgICAgICAgICAgIEFkZCB0aGlzIGxpbmUgaW4geW91ciA8aGVhZGVyPjpcbiAqICAgICAgICAgICAgICAgIDxzY3JpcHQgc3JjPVwiaHR0cHM6Ly9hZHJpYW5vdGlnZXIuZ2l0aHViLmlvL3dlYi1lc2hlZXAvc3JjL2VzaGVlcC5qc1wiPjwvc2NyaXB0PlxuICogICAgICAgICAgICAgICAgQWRkIHRoaXMgbGluZXMgaW4geW91ciA8Ym9keT4gKGF0IHRoZSBlbmQgaWYgcG9zc2libGUpOlxuICogICAgICAgICAgICAgICAgPHNjcmlwdD5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHBldCA9IG5ldyBlU2hlZXAoKTtcbiAgICAgICAgICAgICAgICAgICAgcGV0LlN0YXJ0KCk7XG4gICAgICAgICAgICAgICAgICA8L3NjcmlwdD5cbiAqICAgICAgICAgICAgICAgIFRoYXQncyBhbGwhXG4gKlxuICogUmVxdWlyZW1lbnQ6XG4gKiAgICAgICAgICAgICAgICBUZXN0ZWQgb24gSUUxMSwgRWRnZSBhbmQgT3BlcmFcbiAqXG4gKiBDaGFuZ2Vsb2c6XG4gKiAgICAgICAgICAgICAgICBWZXJzaW9uIDAuOC4wIC0gMjkuMDUuMjAxODpcbiAqICAgICAgICAgICAgICAgICAgLSBNb3ZlZCBhbmltYXRpb24gZmlsZXMgdG8gZ2l0aHViXG4gKiAgICAgICAgICAgICAgICAgIC0gQWRkZWQgb3B0aW9ucyB0byB0aGUgc2NyaXB0IFxuICogICAgICAgICAgICAgICAgICAtIExvYWQgYW4gYW5pbWF0aW9uIGZyb20gdGhlIEdpdEh1YiBhbmltYXRpb25zIGZyb20gdGhlIHBvcHVwIHdpbmRvd1xuICogICAgICAgICAgICAgICAgVmVyc2lvbiAwLjcuMSAtIDA0LjA0LjIwMTg6XG4gKiAgICAgICAgICAgICAgICAgIC0gQWRkIG1heC13aWR0aDogbm9uZSB0byBlbnN1cmUgdGhlIGltYWdlIGlzIHByb3Blcmx5IHNob3duXG4gKiAgICAgICAgICAgICAgICBWZXJzaW9uIDAuNyAtIDEzLjExLjIwMTc6XG4gKiAgICAgICAgICAgICAgICAgIC0gYmV0dGVyIEphdmFzY3JpcHQgc3RydWN0dXJlXG4gKiAgICAgICAgICAgICAgICAgIC0gR2l0SHViIHZlcnNpb24gKGh0dHBzOi8vZ2l0aHViLmNvbS9BZHJpYW5vdGlnZXIvd2ViLWVzaGVlcClcbiAqICAgICAgICAgICAgICAgICAgLSBDaGlsZHMgYW5pbWF0aW9ucyBhZGRlZFxuICogICAgICAgICAgICAgICAgICAtIEJldHRlciBjb21tZW50c1xuICogICAgICAgICAgICAgICAgICAtIFJlcGxhY2VkIGFsZXJ0cyB3aXRoIGNvbnNvbGUuZXJyb3JcbiAqICAgICAgICAgICAgICAgIFZlcnNpb24gMC41IC0gMTIuMDcuMjAxNzpcbiAqICAgICAgICAgICAgICAgICAgLSBhbmltYXRpb25zIHN0YXJ0cyBvbmx5IG9uY2UgdGhlIGltYWdlIHdhcyBsb2FkZWQgKHRoYW5rcyBSZWRTcGFycjB3KVxuICogICAgICAgICAgICAgICAgVmVyc2lvbiAwLng6XG4gKiAgICAgICAgICAgICAgICAgIC0gc3RpbGwgYmV0YSB2ZXJzaW9ucy4uLlxuICovXG5cbnZhciBWRVJTSU9OID0gJzAuOC4wJzsgLy8gd2ViIGVTaGVlcCB2ZXJzaW9uXG52YXIgQUNUSVZBVEVfREVCVUcgPSBmYWxzZTsgLy8gc2hvdyBsb2cgb24gY29uc29sZVxudmFyIERFRkFVTFRfWE1MID0gXCJodHRwczovL2Fkcmlhbm90aWdlci5naXRodWIuaW8vd2ViLWVzaGVlcC9wZXRzL29yaWdpbmFsLnhtbFwiOyAvLyBkZWZhdWx0IFhNTCBhbmltYXRpb25cbnZhciBDT0xMSVNJT05fV0lUSCA9IFtcImRpdlwiLCBcImhyXCJdOyAvLyBlbGVtZW50cyBvbiBwYWdlIHRvIGRldGVjdCBmb3IgY29sbGlzaW9uc1xuXG4vKlxuICogZVNoZWVwIGNsYXNzLlxuICogQ3JlYXRlIGEgbmV3IGNsYXNzIG9mIHRoaXMgdHlwZSBpZiB5b3Ugd2FudCBhIG5ldyBwZXQuIFdpbGwgY3JlYXRlIHRoZSBjb21wb25lbnRzIGZvciB0aGUgcGV0LlxuICogT25jZSBjcmVhdGVkLCB5b3UgY2FuIGNhbGwgW3ZhcmlhYmxlTmFtZV0uU3RhcnQoKSB0byBzdGFydCB0aGUgYW5pbWF0aW9uIHdpdGggeW91ciBkZXNpcmVkIHBldC5cbiAqL1xuXG52YXIgZVNoZWVwID0gZnVuY3Rpb24gKCkge1xuICAvKiBQYXJhbWV0ZXJzIGZvciBvcHRpb25zIFtkZWZhdWx0XTpcbiAgICogLSBhbGxvd1BldHM6IFtub25lXSwgYWxsXG4gICAqIC0gYWxsb3dQb3B1cDogW3llc10sIG5vXG4gICAqL1xuICBmdW5jdGlvbiBlU2hlZXAob3B0aW9ucywgaXNDaGlsZCkge1xuICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBlU2hlZXApO1xuXG4gICAgdGhpcy51c2VyT3B0aW9ucyA9IG9wdGlvbnMgPyBvcHRpb25zIDogeyBhbGxvd1BldHM6IFwibm9uZVwiLCBhbGxvd1BvcHVwOiBcInllc1wiIH07XG4gICAgaWYgKCF0aGlzLnVzZXJPcHRpb25zLmFsbG93UG9wdXApIHRoaXMudXNlck9wdGlvbnMuYWxsb3dQb3B1cCA9IFwieWVzXCI7XG4gICAgaWYgKCF0aGlzLnVzZXJPcHRpb25zLmFsbG93UGV0cykgdGhpcy51c2VyT3B0aW9ucy5hbGxvd1BldHMgPSBcIm5vbmVcIjtcblxuICAgIC8vIENPUlM6IENyb3NzIGNhbGxzIGFyZSBub3QgYWNjZXB0ZWQgYnkgbmV3IGJyb3dzZXJzLlxuICAgIC8vIFRoaXMgUEhQLXNjcmlwdCBhbGxvd3MgdG8gY2FsbCB0aGUgcGFnZSBhbHNvIGZyb20gb3RoZXIgZG9tYWluc1xuICAgIHRoaXMuYW5pbWF0aW9uRmlsZSA9IERFRkFVTFRfWE1MO1xuXG4gICAgdGhpcy5pZCA9IERhdGUubm93KCkgKyBNYXRoLnJhbmRvbSgpO1xuXG4gICAgdGhpcy5ET01kaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpOyAvLyBEaXYgYWRkZWQgdG8gd2VicGFnZSwgY29udGFpbmluZyB0aGUgc2hlZXBcbiAgICB0aGlzLkRPTWRpdi5zZXRBdHRyaWJ1dGUoXCJpZFwiLCB0aGlzLmlkKTtcbiAgICB0aGlzLkRPTWltZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbWdcIik7IC8vIFRpbGUgaW1hZ2UsIHdpbGwgYmUgcG9zaXRpb25lZCBpbnNpZGUgdGhlIGRpdlxuICAgIHRoaXMuRE9NaW5mbyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7IC8vIGFib3V0IGRpYWxvZywgaWYgeW91IHByZXNzIG9uIHRoZSBzaGVlcFxuXG4gICAgdGhpcy5wYXJzZXIgPSBuZXcgRE9NUGFyc2VyKCk7IC8vIFhNTCBwYXJzZXJcbiAgICB0aGlzLnhtbERvYyA9IG51bGw7IC8vIHBhcnNlZCBYTUwgRG9jdW1lbnRcbiAgICB0aGlzLnByZXBhcmVUb0RpZSA9IGZhbHNlOyAvLyB3aGVuIHJlbW92ZWQsIGFuaW1hdGlvbnMgc2hvdWxkIGJlIHN0b3BwZWRcblxuICAgIHRoaXMuaXNDaGlsZCA9IGlzQ2hpbGQgIT0gbnVsbDsgLy8gQ2hpbGQgd2lsbCBiZSByZW1vdmVkIG9uY2UgdGhleSByZWFjaGVkIHRoZSBlbmRcblxuICAgIHRoaXMudGlsZXNYID0gMTsgLy8gUXVhbnRpdHkgb2YgaW1hZ2VzIGluc2lkZSBUaWxlXG4gICAgdGhpcy50aWxlc1kgPSAxOyAvLyBRdWFudGl0eSBvZiBpbWFnZXMgaW5zaWRlIFRpbGVcbiAgICB0aGlzLmltYWdlVyA9IDE7IC8vIFdpZHRoIG9mIHRoZSBzcHJpdGUgaW1hZ2VcbiAgICB0aGlzLmltYWdlSCA9IDE7IC8vIEhlaWdodCBvZiB0aGUgc3ByaXRlIGltYWdlXG4gICAgdGhpcy5pbWFnZVggPSAxOyAvLyBQb3NpdGlvbiBvZiBzcHJpdGUgaW5zaWRlIHdlYnBhZ2VcbiAgICB0aGlzLmltYWdlWSA9IDE7IC8vIFBvc2l0aW9uIG9mIHNwcml0ZSBpbnNpZGUgd2VicGFnZVxuICAgIHRoaXMuZmxpcHBlZCA9IGZhbHNlOyAvLyBpZiBzcHJpdGUgaXMgZmxpcHBlZFxuICAgIHRoaXMuZHJhZ2dpbmcgPSBmYWxzZTsgLy8gaWYgdXNlciBpcyBkcmFnZ2luZyB0aGUgc2hlZXBcbiAgICB0aGlzLmluZm9ib3ggPSBmYWxzZTsgLy8gaWYgaW5mb2JveCBpcyB2aXNpYmxlXG4gICAgdGhpcy5hbmltYXRpb25JZCA9IDA7IC8vIGN1cnJlbnQgYW5pbWF0aW9uIElEXG4gICAgdGhpcy5hbmltYXRpb25TdGVwID0gMDsgLy8gY3VycmVudCBhbmltYXRpb24gc3RlcFxuICAgIHRoaXMuYW5pbWF0aW9uTm9kZSA9IG51bGw7IC8vIGN1cnJlbnQgYW5pbWF0aW9uIERPTSBub2RlXG4gICAgdGhpcy5zcHJpdGUgPSBuZXcgSW1hZ2UoKTsgLy8gc3ByaXRlIGltYWdlIChUaWxlcylcbiAgICB0aGlzLkhUTUxlbGVtZW50ID0gbnVsbDsgLy8gdGhlIEhUTUwgZWxlbWVudCB3aGVyZSB0aGUgcGV0IGlzIHdhbGtpbmcgb25cbiAgICB0aGlzLnJhbmRTID0gTWF0aC5yYW5kb20oKSAqIDEwMDsgLy8gcmFuZG9tIHZhbHVlLCB3aWxsIGNoYW5nZSB3aGVuIHBhZ2UgaXMgcmVsb2FkZWRcblxuICAgIHRoaXMuc2NyZWVuVyA9IHdpbmRvdy5pbm5lcldpZHRoIHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCB8fCBkb2N1bWVudC5ib2R5LmNsaWVudFdpZHRoOyAvLyB3aW5kb3cgd2lkdGhcblxuICAgIHRoaXMuc2NyZWVuSCA9IHdpbmRvdy5pbm5lckhlaWdodCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0IHx8IGRvY3VtZW50LmJvZHkuY2xpZW50SGVpZ2h0OyAvLyB3aW5kb3cgaGVpZ2h0XG4gIH1cblxuICAvKlxuICAgKiBTdGFydCBuZXcgYW5pbWF0aW9uIG9uIHRoZSBwYWdlLlxuICAgKiBpZiBhbmltYXRpb24gaXMgbm90IHNldCwgdGhlIGRlZmF1bHQgc2hlZXAgd2lsbCBiZSB0YWtlblxuICAgKi9cblxuXG4gIF9jcmVhdGVDbGFzcyhlU2hlZXAsIFt7XG4gICAga2V5OiBcIlN0YXJ0XCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIFN0YXJ0KGFuaW1hdGlvbikge1xuICAgICAgaWYgKHR5cGVvZiBhbmltYXRpb24gIT09ICd1bmRlZmluZWQnICYmIGFuaW1hdGlvbiAhPSBudWxsKSB7XG4gICAgICAgIHRoaXMuYW5pbWF0aW9uRmlsZSA9IGFuaW1hdGlvbjtcbiAgICAgIH1cblxuICAgICAgdmFyIGFqYXggPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgICAgIHZhciBzaGVlcENsYXNzID0gdGhpcztcblxuICAgICAgYWpheC5vcGVuKFwiR0VUXCIsIHRoaXMuYW5pbWF0aW9uRmlsZSwgdHJ1ZSk7XG4gICAgICBhamF4LmFkZEV2ZW50TGlzdGVuZXIoXCJyZWFkeXN0YXRlY2hhbmdlXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMucmVhZHlTdGF0ZSA9PSA0KSB7XG4gICAgICAgICAgaWYgKHRoaXMuc3RhdHVzID09IDIwMClcbiAgICAgICAgICAgIC8vIHN1Y2Nlc3NmdWxseSBsb2FkZWQgWE1MLCBwYXJzZSBpdCBhbmQgY3JlYXRlIGZpcnN0IGVzaGVlcC5cbiAgICAgICAgICAgIHNoZWVwQ2xhc3MuX3BhcnNlWE1MKHRoaXMucmVzcG9uc2VUZXh0KTtlbHNlIGNvbnNvbGUuZXJyb3IoXCJYTUwgbm90IGF2YWlsYWJsZTpcIiArIHRoaXMuc3RhdHVzVGV4dCArIFwiXFxuXCIgKyB0aGlzLnJlc3BvbnNlVGV4dCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgYWpheC5zZW5kKG51bGwpO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogXCJyZW1vdmVcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3ZlKCkge1xuICAgICAgdmFyIF90aGlzID0gdGhpcztcblxuICAgICAgdGhpcy5wcmVwYXJlVG9EaWUgPSB0cnVlO1xuICAgICAgdGhpcy5ET01pbmZvLkhpZGUoKTtcbiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICBfdGhpcy5ET01kaXYgPSBfdGhpcy5ET01pbWcgPSBfdGhpcy5ET01pbmZvID0gbnVsbDtcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoX3RoaXMuaWQpLm91dGVySFRNTCA9ICcnO1xuICAgICAgfSwgNTAwKTtcbiAgICB9XG5cbiAgICAvKlxuICAgICAqIFBhcnNlIGxvYWRlZCBYTUwsIGNvbnRhaW5zIHNwYXduLCBhbmltYXRpb25zIGFuZCBjaGlsZHNcbiAgICAgKi9cblxuICB9LCB7XG4gICAga2V5OiBcIl9wYXJzZVhNTFwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBfcGFyc2VYTUwodGV4dCkge1xuICAgICAgdmFyIF90aGlzMiA9IHRoaXM7XG5cbiAgICAgIHRoaXMueG1sRG9jID0gdGhpcy5wYXJzZXIucGFyc2VGcm9tU3RyaW5nKHRleHQsICd0ZXh0L3htbCcpO1xuICAgICAgdmFyIGltYWdlID0gdGhpcy54bWxEb2MuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2ltYWdlJylbMF07XG4gICAgICB0aGlzLnRpbGVzWCA9IGltYWdlLmdldEVsZW1lbnRzQnlUYWdOYW1lKFwidGlsZXN4XCIpWzBdLnRleHRDb250ZW50O1xuICAgICAgdGhpcy50aWxlc1kgPSBpbWFnZS5nZXRFbGVtZW50c0J5VGFnTmFtZShcInRpbGVzeVwiKVswXS50ZXh0Q29udGVudDtcbiAgICAgIC8vIEV2ZW50IGxpc3RlbmVyOiBTcHJpdGUgd2FzIGxvYWRlZCA9PlxuICAgICAgLy8gICBwbGF5IGFuaW1hdGlvbiBvbmx5IHdoZW4gdGhlIHNwcml0ZSBpcyBsb2FkZWRcbiAgICAgIHRoaXMuc3ByaXRlLmFkZEV2ZW50TGlzdGVuZXIoXCJsb2FkXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKEFDVElWQVRFX0RFQlVHKSBjb25zb2xlLmxvZyhcIlNwcml0ZSBpbWFnZSBsb2FkZWRcIik7XG4gICAgICAgIHZhciBhdHRyaWJ1dGUgPSBcIndpZHRoOlwiICsgX3RoaXMyLnNwcml0ZS53aWR0aCArIFwicHg7XCIgKyBcImhlaWdodDpcIiArIF90aGlzMi5zcHJpdGUuaGVpZ2h0ICsgXCJweDtcIiArIFwicG9zaXRpb246YWJzb2x1dGU7XCIgKyBcInRvcDowcHg7XCIgKyBcImxlZnQ6MHB4O1wiICsgXCJtYXgtd2lkdGg6IG5vbmU7XCI7XG4gICAgICAgIF90aGlzMi5ET01pbWcuc2V0QXR0cmlidXRlKFwic3R5bGVcIiwgYXR0cmlidXRlKTtcbiAgICAgICAgLy8gcHJldmVudCB0byBtb3ZlIGltYWdlICh3aWxsIHNob3cgdGhlIGVudGlyZSBzcHJpdGUgc2hlZXQgaWYgbm90IGNhdGNoZWQpXG4gICAgICAgIF90aGlzMi5ET01pbWcuYWRkRXZlbnRMaXN0ZW5lcihcImRyYWdzdGFydFwiLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtyZXR1cm4gZmFsc2U7XG4gICAgICAgIH0pO1xuICAgICAgICBfdGhpczIuaW1hZ2VXID0gX3RoaXMyLnNwcml0ZS53aWR0aCAvIF90aGlzMi50aWxlc1g7XG4gICAgICAgIF90aGlzMi5pbWFnZUggPSBfdGhpczIuc3ByaXRlLmhlaWdodCAvIF90aGlzMi50aWxlc1k7XG4gICAgICAgIC8vaWYodHlwZW9mIHRoaXMuaW1hZ2VYID09ICd1bmRlZmluZWQnKSB0aGlzLmltYWdlWCA9IDA7XG4gICAgICAgIC8vaWYodHlwZW9mIHRoaXMuaW1hZ2VZID09ICd1bmRlZmluZWQnKSB0aGlzLmltYWdlWSA9IHRoaXMuc2NyZWVuSCAtIHRoaXMuc3ByaXRlLmhlaWdodCAvIHRoaXMudGlsZXNZO1xuICAgICAgICBhdHRyaWJ1dGUgPSBcIndpZHRoOlwiICsgX3RoaXMyLmltYWdlVyArIFwicHg7XCIgKyBcImhlaWdodDpcIiArIF90aGlzMi5pbWFnZUggKyBcInB4O1wiICsgXCJwb3NpdGlvbjpmaXhlZDtcIiArIFwidG9wOlwiICsgX3RoaXMyLmltYWdlWSArIFwicHg7XCIgKyBcImxlZnQ6XCIgKyBfdGhpczIuaW1hZ2VYICsgXCJweDtcIiArIFwidHJhbnNmb3JtOnJvdGF0ZXkoMGRlZyk7XCIgKyBcImN1cnNvcjptb3ZlO1wiICsgXCJ6LWluZGV4OjIwMDA7XCIgKyBcIm92ZXJmbG93OmhpZGRlbjtcIjtcbiAgICAgICAgX3RoaXMyLkRPTWRpdi5zZXRBdHRyaWJ1dGUoXCJzdHlsZVwiLCBhdHRyaWJ1dGUpO1xuICAgICAgICBfdGhpczIuRE9NZGl2LmFwcGVuZENoaWxkKF90aGlzMi5ET01pbWcpO1xuXG4gICAgICAgIGlmIChfdGhpczIuaXNDaGlsZCkgX3RoaXMyLl9zcGF3bkNoaWxkKCk7ZWxzZSBfdGhpczIuX3NwYXduRVNoZWVwKCk7XG4gICAgICB9KTtcblxuICAgICAgdGhpcy5zcHJpdGUuc3JjID0gJ2RhdGE6aW1hZ2UvcG5nO2Jhc2U2NCwnICsgaW1hZ2UuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJwbmdcIilbMF0udGV4dENvbnRlbnQ7XG4gICAgICB0aGlzLkRPTWltZy5zZXRBdHRyaWJ1dGUoXCJzcmNcIiwgdGhpcy5zcHJpdGUuc3JjKTtcblxuICAgICAgLy8gTW91c2UgbW92ZSBvdmVyIGVTaGVlcCwgY2hlY2sgaWYgZVNoZWVwIHNob3VsZCBiZSBtb3ZlZCBvdmVyIHRoZSBzY3JlZW5cbiAgICAgIHRoaXMuRE9NZGl2LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZW1vdmVcIiwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgaWYgKCFfdGhpczIuZHJhZ2dpbmcgJiYgZS5idXR0b25zID09IDEgJiYgZS5idXR0b24gPT0gMCkge1xuICAgICAgICAgIF90aGlzMi5kcmFnZ2luZyA9IHRydWU7XG4gICAgICAgICAgX3RoaXMyLkhUTUxlbGVtZW50ID0gbnVsbDtcbiAgICAgICAgICB2YXIgY2hpbGRzUm9vdCA9IF90aGlzMi54bWxEb2MuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2FuaW1hdGlvbnMnKVswXTtcbiAgICAgICAgICB2YXIgY2hpbGRzID0gY2hpbGRzUm9vdC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnYW5pbWF0aW9uJyk7XG4gICAgICAgICAgZm9yICh2YXIgayA9IDA7IGsgPCBjaGlsZHMubGVuZ3RoOyBrKyspIHtcbiAgICAgICAgICAgIGlmIChjaGlsZHNba10uZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ25hbWUnKVswXS50ZXh0Q29udGVudCA9PSBcImRyYWdcIikge1xuICAgICAgICAgICAgICBfdGhpczIuYW5pbWF0aW9uSWQgPSBjaGlsZHNba10uZ2V0QXR0cmlidXRlKFwiaWRcIik7XG4gICAgICAgICAgICAgIF90aGlzMi5hbmltYXRpb25TdGVwID0gMDtcbiAgICAgICAgICAgICAgX3RoaXMyLmFuaW1hdGlvbk5vZGUgPSBjaGlsZHNba107XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICAvLyBBZGQgZXZlbnQgbGlzdGVuZXIgdG8gYm9keSwgaWYgbW91c2UgbW92ZWQgdG9vIGZhc3Qgb3ZlciB0aGUgZHJhZ2dpbmcgZVNoZWVwXG4gICAgICBkb2N1bWVudC5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZW1vdmVcIiwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgaWYgKF90aGlzMi5kcmFnZ2luZykge1xuICAgICAgICAgIF90aGlzMi5pbWFnZVggPSBwYXJzZUludChlLmNsaWVudFgpIC0gX3RoaXMyLmltYWdlVyAvIDI7XG4gICAgICAgICAgX3RoaXMyLmltYWdlWSA9IHBhcnNlSW50KGUuY2xpZW50WSkgLSBfdGhpczIuaW1hZ2VIIC8gMjtcblxuICAgICAgICAgIF90aGlzMi5ET01kaXYuc3R5bGUubGVmdCA9IF90aGlzMi5pbWFnZVggKyBcInB4XCI7XG4gICAgICAgICAgX3RoaXMyLkRPTWRpdi5zdHlsZS50b3AgPSBfdGhpczIuaW1hZ2VZICsgXCJweFwiO1xuICAgICAgICAgIF90aGlzMi5ET01pbmZvLnN0eWxlLmxlZnQgPSBwYXJzZUludChfdGhpczIuaW1hZ2VYICsgX3RoaXMyLmltYWdlVyAvIDIpICsgXCJweFwiO1xuICAgICAgICAgIF90aGlzMi5ET01pbmZvLnN0eWxlLnRvcCA9IF90aGlzMi5pbWFnZVkgKyBcInB4XCI7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgLy8gV2luZG93IHJlc2l6ZWQsIHJlY2FsY3VsYXRlIGVTaGVlcCBib3VuZHNcbiAgICAgIGRvY3VtZW50LmJvZHkuYWRkRXZlbnRMaXN0ZW5lcihcInJlc2l6ZVwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIF90aGlzMi5zY3JlZW5XID0gd2luZG93LmlubmVyV2lkdGggfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoIHx8IGRvY3VtZW50LmJvZHkuY2xpZW50V2lkdGg7XG5cbiAgICAgICAgX3RoaXMyLnNjcmVlbkggPSB3aW5kb3cuaW5uZXJIZWlnaHQgfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodCB8fCBkb2N1bWVudC5ib2R5LmNsaWVudEhlaWdodDtcblxuICAgICAgICBpZiAoX3RoaXMyLmltYWdlWSArIF90aGlzMi5pbWFnZUggPiBfdGhpczIuc2NyZWVuSCkge1xuICAgICAgICAgIF90aGlzMi5pbWFnZVkgPSBfdGhpczIuc2NyZWVuSCAtIF90aGlzMi5pbWFnZUg7XG4gICAgICAgICAgX3RoaXMyLkRPTWRpdi5zdHlsZS50b3AgPSBfdGhpczIuaW1hZ2VZICsgXCJweFwiO1xuICAgICAgICB9XG4gICAgICAgIGlmIChfdGhpczIuaW1hZ2VYICsgX3RoaXMyLmltYWdlVyA+IF90aGlzMi5zY3JlZW5XKSB7XG4gICAgICAgICAgX3RoaXMyLmltYWdlWCA9IF90aGlzMi5zY3JlZW5XIC0gX3RoaXMyLmltYWdlVztcbiAgICAgICAgICBfdGhpczIuRE9NZGl2LnN0eWxlLmxlZnQgPSBfdGhpczIuaW1hZ2VYICsgXCJweFwiO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIC8vIERvbid0IGFsbG93IGNvbnRleHRtZW51IG92ZXIgdGhlIHNoZWVwXG4gICAgICB0aGlzLkRPTWRpdi5hZGRFdmVudExpc3RlbmVyKFwiY29udGV4dG1lbnVcIiwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9KTtcbiAgICAgIC8vIE1vdXNlIHJlbGVhc2VkXG4gICAgICB0aGlzLkRPTWRpdi5hZGRFdmVudExpc3RlbmVyKFwibW91c2V1cFwiLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICBpZiAoX3RoaXMyLmRyYWdnaW5nKSB7XG4gICAgICAgICAgX3RoaXMyLmRyYWdnaW5nID0gZmFsc2U7XG4gICAgICAgIH0gZWxzZSBpZiAoX3RoaXMyLmluZm9ib3gpIHtcbiAgICAgICAgICBfdGhpczIuRE9NaW5mby5IaWRlKCk7XG4gICAgICAgICAgX3RoaXMyLmluZm9ib3ggPSBmYWxzZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpZiAoX3RoaXMyLnVzZXJPcHRpb25zLmFsbG93UG9wdXAgPT09IFwieWVzXCIpIHtcbiAgICAgICAgICAgIF90aGlzMi5ET01pbmZvLnN0eWxlLmxlZnQgPSBNYXRoLm1pbihfdGhpczIuc2NyZWVuVyAtIF90aGlzMi5pbWFnZVcsIE1hdGgubWF4KF90aGlzMi5pbWFnZVcsIHBhcnNlSW50KF90aGlzMi5pbWFnZVggKyBfdGhpczIuaW1hZ2VXIC8gMikpKSArIFwicHhcIjtcbiAgICAgICAgICAgIF90aGlzMi5ET01pbmZvLnN0eWxlLnRvcCA9IHBhcnNlSW50KF90aGlzMi5pbWFnZVkpICsgXCJweFwiO1xuICAgICAgICAgICAgX3RoaXMyLkRPTWluZm8uU2hvdygpO1xuICAgICAgICAgICAgX3RoaXMyLmluZm9ib3ggPSB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICAvLyBNb3VzZSByZWxlYXNlZCBvdmVyIHRoZSBpbmZvIGJveFxuICAgICAgdGhpcy5ET01pbmZvLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZXVwXCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIF90aGlzMi5ET01pbmZvLkhpZGUoKTtcbiAgICAgICAgX3RoaXMyLmluZm9ib3ggPSBmYWxzZTtcbiAgICAgIH0pO1xuICAgICAgLy8gQ3JlYXRlIEFib3V0IGJveFxuICAgICAgdmFyIGF0dHJpYnV0ZSA9IFwid2lkdGg6MjAwcHg7XCIgKyBcImhlaWdodDoxMDBweDtcIiArIFwidHJhbnNmb3JtOnRyYW5zbGF0ZSgtNTAlLCAtNTAlKSBzY2FsZSgwLjEpO1wiICsgXCJwb3NpdGlvbjpmaXhlZDtcIiArIFwidG9wOjEwMHB4O2xlZnQ6MTBweDtcIiArIFwiZGlzcGxheTpub25lO1wiICsgXCJib3JkZXItd2lkdGg6MnB4O1wiICsgXCJib3JkZXItcmFkaXVzOjVweDtcIiArIFwiYm9yZGVyLXN0eWxlOnJpZGdlO1wiICsgXCJib3JkZXItY29sb3I6IzAwMDBhYjtcIiArIFwidGV4dC1hbGlnbjpjZW50ZXI7XCIgKyBcInRleHQtc2hhZG93OiAxcHggMXB4IDNweCAjZmZmZjg4O1wiICsgXCJib3gtc2hhZG93OiAzcHggM3B4IDEwcHggIzg4ODg4ODtcIiArIFwiY29sb3I6YmxhY2s7XCIgKyBcIm9wYWNpdHk6MC45O1wiICsgXCJ6LWluZGV4Ojk5OTk7XCIgKyBcIm92ZXJmbG93OmF1dG87XCIgKyBcInRyYW5zaXRpb246dHJhbnNmb3JtIDAuM3MgZWFzZTtcIiArIFwiYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KHRvIGJvdHRvbSByaWdodCwgcmdiYSgxMjgsMTI4LDI1NSwwLjcpLCByZ2JhKDIwMCwyMDAsMjU1LDAuNCkpO1wiO1xuICAgICAgdGhpcy5ET01pbmZvLnNldEF0dHJpYnV0ZShcInN0eWxlXCIsIGF0dHJpYnV0ZSk7XG4gICAgICB2YXIgaGVhZGVyTm9kZSA9IHRoaXMueG1sRG9jLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdoZWFkZXInKVswXTtcbiAgICAgIHZhciBodG1sVCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJiXCIpLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGhlYWRlck5vZGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3RpdGxlJylbMF0udGV4dENvbnRlbnQpKTtcbiAgICAgIHZhciBodG1sViA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzdXBcIik7XG4gICAgICB2YXIgaHRtbEwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYVwiKTtcbiAgICAgIHZhciBodG1sUCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJwXCIpO1xuICAgICAgaHRtbFYuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoXCJBcHAgdi5cIiArIFZFUlNJT04pKTtcbiAgICAgIGh0bWxWLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJiclwiKSk7XG4gICAgICBodG1sVi5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShcIlBldCB2LlwiICsgaGVhZGVyTm9kZS5nZXRFbGVtZW50c0J5VGFnTmFtZSgndmVyc2lvbicpWzBdLnRleHRDb250ZW50KSk7XG4gICAgICBodG1sVi5zZXRBdHRyaWJ1dGUoXCJzdHlsZVwiLCBcImZsb2F0OnJpZ2h0O3RleHQtYWxpZ246cmlnaHQ7XCIpO1xuICAgICAgaHRtbEwuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoXCJcXHVEODNDXFx1REZFMFwiKSk7XG4gICAgICBodG1sTC5zZXRBdHRyaWJ1dGUoXCJocmVmXCIsIFwiaHR0cHM6Ly9naXRodWIuY29tL0Fkcmlhbm90aWdlci93ZWItZXNoZWVwXCIpO1xuICAgICAgaHRtbEwuc2V0QXR0cmlidXRlKFwidGFyZ2V0XCIsIFwiX2JsYW5rXCIpO1xuICAgICAgaHRtbEwuc2V0QXR0cmlidXRlKFwic3R5bGVcIiwgXCJmbG9hdDpsZWZ0XCIpO1xuICAgICAgaHRtbFAuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoaGVhZGVyTm9kZS5nZXRFbGVtZW50c0J5VGFnTmFtZSgnaW5mbycpWzBdLnRleHRDb250ZW50KSk7XG4gICAgICBodG1sUC5zZXRBdHRyaWJ1dGUoXCJzdHlsZVwiLCBcImZvbnQtc2l6ZTpcIiArICgxMDAgLSBwYXJzZUludChoZWFkZXJOb2RlLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdpbmZvJylbMF0udGV4dENvbnRlbnQubGVuZ3RoIC8gMTApKSArIFwiJTtcIik7XG4gICAgICB0aGlzLkRPTWluZm8uYXBwZW5kQ2hpbGQoaHRtbFYpO1xuICAgICAgdGhpcy5ET01pbmZvLmFwcGVuZENoaWxkKGh0bWxMKTtcbiAgICAgIGlmICh0aGlzLnVzZXJPcHRpb25zLmFsbG93UGV0cyAhPT0gXCJub25lXCIpIHtcbiAgICAgICAgaHRtbEwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYVwiKTtcbiAgICAgICAgaHRtbEwuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoXCJcXHUyNjk5XCIpKTtcbiAgICAgICAgaHRtbEwuc2V0QXR0cmlidXRlKFwiaHJlZlwiLCBcImphdmFzY3JpcHQ6O1wiKTtcbiAgICAgICAgaHRtbEwuc2V0QXR0cmlidXRlKFwic3R5bGVcIiwgXCJmbG9hdDpsZWZ0XCIpO1xuICAgICAgICB0aGlzLkRPTWluZm8uYXBwZW5kQ2hpbGQoaHRtbEwpO1xuICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBfdGhpczIuX2xvYWRQZXRMaXN0KGh0bWxMKTtcbiAgICAgICAgfSwgMTAwKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuRE9NaW5mby5hcHBlbmRDaGlsZChodG1sVCk7XG4gICAgICB0aGlzLkRPTWluZm8uYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJyXCIpKTtcbiAgICAgIHRoaXMuRE9NaW5mby5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaHJcIikpO1xuICAgICAgdGhpcy5ET01pbmZvLmFwcGVuZENoaWxkKGh0bWxQKTtcbiAgICAgIC8vIEFkZCBhYm91dCBhbmQgc2hlZXAgZWxlbWVudHMgdG8gdGhlIGJvZHlcbiAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGhpcy5ET01pbmZvKTtcbiAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGhpcy5ET01kaXYpO1xuXG4gICAgICB0aGlzLkRPTWluZm8uU2hvdyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgX3RoaXMyLkRPTWluZm8uc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcbiAgICAgICAgX3RoaXMyLkRPTWluZm8uc3R5bGUudHJhbnNmb3JtID0gXCJ0cmFuc2xhdGUoLTUwJSwgLTEwMCUpIHNjYWxlKDEuMClcIjtcbiAgICAgIH07XG4gICAgICB0aGlzLkRPTWluZm8uSGlkZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgX3RoaXMyLkRPTWluZm8uc3R5bGUudHJhbnNmb3JtID0gXCJ0cmFuc2xhdGUoLTUwJSwgLTUwJSkgc2NhbGUoMC4xKVwiO1xuICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBfdGhpczIuRE9NaW5mby5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgICAgIH0sIDMwMCk7XG4gICAgICB9O1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogXCJfc2V0UG9zaXRpb25cIixcblxuXG4gICAgLypcbiAgICAgKiBTZXQgbmV3IHBvc2l0aW9uIGZvciB0aGUgcGV0XG4gICAgICogSWYgYWJzb2x1dGUgaXMgdHJ1ZSwgdGhlIHggYW5kIHkgY29vcmRpbmF0ZXMgYXJlIHVzZWQgYXMgYWJzb2x1dGUgdmFsdWVzLlxuICAgICAqIElmIGZhbHNlLCB4IGFuZCB5IGFyZSBhZGRlZCB0byB0aGUgY3VycmVudCBwb3NpdGlvblxuICAgICAqL1xuICAgIHZhbHVlOiBmdW5jdGlvbiBfc2V0UG9zaXRpb24oeCwgeSwgYWJzb2x1dGUpIHtcbiAgICAgIGlmICh0aGlzLkRPTWRpdikge1xuICAgICAgICBpZiAoYWJzb2x1dGUpIHtcbiAgICAgICAgICB0aGlzLmltYWdlWCA9IHBhcnNlSW50KHgpO1xuICAgICAgICAgIHRoaXMuaW1hZ2VZID0gcGFyc2VJbnQoeSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5pbWFnZVggPSBwYXJzZUludCh0aGlzLmltYWdlWCkgKyBwYXJzZUludCh4KTtcbiAgICAgICAgICB0aGlzLmltYWdlWSA9IHBhcnNlSW50KHRoaXMuaW1hZ2VZKSArIHBhcnNlSW50KHkpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuRE9NZGl2LnN0eWxlLmxlZnQgPSB0aGlzLmltYWdlWCArIFwicHhcIjtcbiAgICAgICAgdGhpcy5ET01kaXYuc3R5bGUudG9wID0gdGhpcy5pbWFnZVkgKyBcInB4XCI7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLypcbiAgICAgKiBTcGF3biBuZXcgZXNoZWVwLCB0aGlzIGlzIGNhbGxlZCBpZiB0aGUgWE1MIHdhcyBsb2FkZWQgc3VjY2Vzc2Z1bGx5XG4gICAgICovXG5cbiAgfSwge1xuICAgIGtleTogXCJfc3Bhd25FU2hlZXBcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gX3NwYXduRVNoZWVwKCkge1xuICAgICAgdmFyIHNwYXduc1Jvb3QgPSB0aGlzLnhtbERvYy5nZXRFbGVtZW50c0J5VGFnTmFtZSgnc3Bhd25zJylbMF07XG4gICAgICB2YXIgc3Bhd25zID0gc3Bhd25zUm9vdC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnc3Bhd24nKTtcbiAgICAgIHZhciBwcm9iID0gMDtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc3Bhd25zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHByb2IgKz0gcGFyc2VJbnQoc3Bhd25zWzBdLmdldEF0dHJpYnV0ZShcInByb2JhYmlsaXR5XCIpKTtcbiAgICAgIH12YXIgcmFuZCA9IE1hdGgucmFuZG9tKCkgKiBwcm9iO1xuICAgICAgcHJvYiA9IDA7XG4gICAgICBmb3IgKGkgPSAwOyBpIDwgc3Bhd25zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHByb2IgKz0gcGFyc2VJbnQoc3Bhd25zW2ldLmdldEF0dHJpYnV0ZShcInByb2JhYmlsaXR5XCIpKTtcbiAgICAgICAgaWYgKHByb2IgPj0gcmFuZCB8fCBpID09IHNwYXducy5sZW5ndGggLSAxKSB7XG4gICAgICAgICAgdGhpcy5fc2V0UG9zaXRpb24odGhpcy5fcGFyc2VLZXlXb3JkcyhzcGF3bnNbaV0uZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3gnKVswXS50ZXh0Q29udGVudCksIHRoaXMuX3BhcnNlS2V5V29yZHMoc3Bhd25zW2ldLmdldEVsZW1lbnRzQnlUYWdOYW1lKCd5JylbMF0udGV4dENvbnRlbnQpLCB0cnVlKTtcbiAgICAgICAgICBpZiAoQUNUSVZBVEVfREVCVUcpIGNvbnNvbGUubG9nKFwiU3Bhd246IFwiICsgdGhpcy5pbWFnZVggKyBcIiwgXCIgKyB0aGlzLmltYWdlWSk7XG4gICAgICAgICAgdGhpcy5hbmltYXRpb25JZCA9IHNwYXduc1tpXS5nZXRFbGVtZW50c0J5VGFnTmFtZSgnbmV4dCcpWzBdLnRleHRDb250ZW50O1xuICAgICAgICAgIHRoaXMuYW5pbWF0aW9uU3RlcCA9IDA7XG4gICAgICAgICAgdmFyIGNoaWxkc1Jvb3QgPSB0aGlzLnhtbERvYy5nZXRFbGVtZW50c0J5VGFnTmFtZSgnYW5pbWF0aW9ucycpWzBdO1xuICAgICAgICAgIHZhciBjaGlsZHMgPSBjaGlsZHNSb290LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdhbmltYXRpb24nKTtcbiAgICAgICAgICBmb3IgKHZhciBrID0gMDsgayA8IGNoaWxkcy5sZW5ndGg7IGsrKykge1xuICAgICAgICAgICAgaWYgKGNoaWxkc1trXS5nZXRBdHRyaWJ1dGUoXCJpZFwiKSA9PSB0aGlzLmFuaW1hdGlvbklkKSB7XG4gICAgICAgICAgICAgIHRoaXMuYW5pbWF0aW9uTm9kZSA9IGNoaWxkc1trXTtcblxuICAgICAgICAgICAgICAvLyBDaGVjayBpZiBjaGlsZCBzaG91bGQgYmUgbG9hZGVkIHRvZ2hldGhlciB3aXRoIHRoaXMgYW5pbWF0aW9uXG4gICAgICAgICAgICAgIHZhciBjaGlsZHNSb290ID0gdGhpcy54bWxEb2MuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2NoaWxkcycpWzBdO1xuICAgICAgICAgICAgICB2YXIgY2hpbGRzID0gY2hpbGRzUm9vdC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnY2hpbGQnKTtcbiAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBjaGlsZHMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICBpZiAoY2hpbGRzW2pdLmdldEF0dHJpYnV0ZShcImFuaW1hdGlvbmlkXCIpID09IHRoaXMuYW5pbWF0aW9uSWQpIHtcbiAgICAgICAgICAgICAgICAgIGlmIChBQ1RJVkFURV9ERUJVRykgY29uc29sZS5sb2coXCJDaGlsZCBmcm9tIFNwYXduXCIpO1xuICAgICAgICAgICAgICAgICAgdmFyIGVTaGVlcENoaWxkID0gbmV3IGVTaGVlcChudWxsLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgIGVTaGVlcENoaWxkLmFuaW1hdGlvbklkID0gY2hpbGRzW2pdLmdldEVsZW1lbnRzQnlUYWdOYW1lKCduZXh0JylbMF0udGV4dENvbnRlbnQ7XG4gICAgICAgICAgICAgICAgICB2YXIgeCA9IGNoaWxkc1tqXS5nZXRFbGVtZW50c0J5VGFnTmFtZSgneCcpWzBdLnRleHRDb250ZW50OyAvL1xuICAgICAgICAgICAgICAgICAgdmFyIHkgPSBjaGlsZHNbal0uZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3knKVswXS50ZXh0Q29udGVudDtcbiAgICAgICAgICAgICAgICAgIGVTaGVlcENoaWxkLl9zZXRQb3NpdGlvbih0aGlzLl9wYXJzZUtleVdvcmRzKHgpLCB0aGlzLl9wYXJzZUtleVdvcmRzKHkpLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgIC8vIFN0YXJ0IGFuaW1hdGlvblxuICAgICAgICAgICAgICAgICAgZVNoZWVwQ2hpbGQuU3RhcnQodGhpcy5hbmltYXRpb25GaWxlKTtcbiAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIC8vIFBsYXkgbmV4dCBzdGVwXG4gICAgICB0aGlzLl9uZXh0RVNoZWVwU3RlcCgpO1xuICAgIH1cblxuICAgIC8qXG4gICAgICogTGlrZSBzcGF3bkVTaGVlcCwgYnV0IGZvciBDaGlsZHNcbiAgICAgKi9cblxuICB9LCB7XG4gICAga2V5OiBcIl9zcGF3bkNoaWxkXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIF9zcGF3bkNoaWxkKCkge1xuICAgICAgdmFyIGNoaWxkc1Jvb3QgPSB0aGlzLnhtbERvYy5nZXRFbGVtZW50c0J5VGFnTmFtZSgnYW5pbWF0aW9ucycpWzBdO1xuICAgICAgdmFyIGNoaWxkcyA9IGNoaWxkc1Jvb3QuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2FuaW1hdGlvbicpO1xuICAgICAgZm9yICh2YXIgayA9IDA7IGsgPCBjaGlsZHMubGVuZ3RoOyBrKyspIHtcbiAgICAgICAgaWYgKGNoaWxkc1trXS5nZXRBdHRyaWJ1dGUoXCJpZFwiKSA9PSB0aGlzLmFuaW1hdGlvbklkKSB7XG4gICAgICAgICAgdGhpcy5hbmltYXRpb25Ob2RlID0gY2hpbGRzW2tdO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICB0aGlzLl9uZXh0RVNoZWVwU3RlcCgpO1xuICAgIH1cblxuICAgIC8vIFBhcnNlIHRoZSBodW1hbiByZWFkYWJsZSBleHByZXNzaW9uIGZyb20gWE1MIHRvIGEgY29tcHV0ZXIgcmVhZGFibGUgZXhwcmVzc2lvblxuXG4gIH0sIHtcbiAgICBrZXk6IFwiX3BhcnNlS2V5V29yZHNcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gX3BhcnNlS2V5V29yZHModmFsdWUpIHtcbiAgICAgIHZhbHVlID0gdmFsdWUucmVwbGFjZSgvc2NyZWVuVy9nLCB0aGlzLnNjcmVlblcpO1xuICAgICAgdmFsdWUgPSB2YWx1ZS5yZXBsYWNlKC9zY3JlZW5IL2csIHRoaXMuc2NyZWVuSCk7XG4gICAgICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoL2FyZWFXL2csIHRoaXMuc2NyZWVuSCk7XG4gICAgICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoL2FyZWFIL2csIHRoaXMuc2NyZWVuSCk7XG4gICAgICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoL2ltYWdlVy9nLCB0aGlzLmltYWdlVyk7XG4gICAgICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoL2ltYWdlSC9nLCB0aGlzLmltYWdlSCk7XG4gICAgICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoL3JhbmRvbS9nLCBNYXRoLnJhbmRvbSgpICogMTAwKTtcbiAgICAgIHZhbHVlID0gdmFsdWUucmVwbGFjZSgvcmFuZFMvZywgdGhpcy5yYW5kUyk7XG4gICAgICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoL2ltYWdlWC9nLCB0aGlzLmltYWdlWCk7XG4gICAgICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoL2ltYWdlWS9nLCB0aGlzLmltYWdlWSk7XG5cbiAgICAgIHZhciByZXQgPSAwO1xuICAgICAgdHJ5IHtcbiAgICAgICAgcmV0ID0gZXZhbCh2YWx1ZSk7XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIlVuYWJsZSB0byBwYXJzZSB0aGlzIHBvc2l0aW9uOiBcXG4nXCIgKyB2YWx1ZSArIFwiJ1xcbiBFcnJvciBtZXNzYWdlOiBcXG5cIiArIGVyci5tZXNzYWdlKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXQ7XG4gICAgfVxuXG4gICAgLypcbiAgICAgKiBPbmNlIHRoZSBhbmltYXRpb24gaXMgb3ZlciwgZ2V0IHRoZSBuZXh0IGFuaW1hdGlvbiB0byBwbGF5XG4gICAgICovXG5cbiAgfSwge1xuICAgIGtleTogXCJfZ2V0TmV4dFJhbmRvbU5vZGVcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gX2dldE5leHRSYW5kb21Ob2RlKHBhcmVudE5vZGUpIHtcbiAgICAgIHZhciBiYXNlTm9kZSA9IHBhcmVudE5vZGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ25leHQnKTtcbiAgICAgIHZhciBjaGlsZHNSb290ID0gdGhpcy54bWxEb2MuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2FuaW1hdGlvbnMnKVswXTtcbiAgICAgIHZhciBjaGlsZHMgPSBjaGlsZHNSb290LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdhbmltYXRpb24nKTtcbiAgICAgIHZhciBwcm9iID0gMDtcbiAgICAgIHZhciBub2RlRm91bmQgPSBmYWxzZTtcblxuICAgICAgLy8gbm8gbW9yZSBhbmltYXRpb25zIChpdCB3YXMgdGhlIGxhc3Qgb25lKVxuICAgICAgaWYgKGJhc2VOb2RlLmxlbmd0aCA9PSAwKSB7XG4gICAgICAgIC8vIElmIGl0IGlzIGEgY2hpbGQsIHJlbW92ZSB0aGUgY2hpbGQgZnJvbSBkb2N1bWVudFxuICAgICAgICBpZiAodGhpcy5pc0NoaWxkKSB7XG4gICAgICAgICAgLy8gcmVtb3ZlIGNoaWxkXG4gICAgICAgICAgaWYgKEFDVElWQVRFX0RFQlVHKSBjb25zb2xlLmxvZyhcIlJlbW92ZSBjaGlsZFwiKTtcbiAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKHRoaXMuRE9NaW5mbyk7XG4gICAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZCh0aGlzLkRPTWRpdik7XG4gICAgICAgICAgZGVsZXRlIHRoaXM7XG4gICAgICAgIH1cbiAgICAgICAgLy8gZWxzZSwgc3Bhd24gc2hlZXAgYWdhaW5cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLl9zcGF3bkVTaGVlcCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuXG4gICAgICBmb3IgKHZhciBrID0gMDsgayA8IGJhc2VOb2RlLmxlbmd0aDsgaysrKSB7XG4gICAgICAgIHByb2IgKz0gcGFyc2VJbnQoYmFzZU5vZGVba10uZ2V0QXR0cmlidXRlKFwicHJvYmFiaWxpdHlcIikpO1xuICAgICAgfVxuICAgICAgdmFyIHJhbmQgPSBNYXRoLnJhbmRvbSgpICogcHJvYjtcbiAgICAgIHZhciBpbmRleCA9IDA7XG4gICAgICBwcm9iID0gMDtcbiAgICAgIGZvciAoayA9IDA7IGsgPCBiYXNlTm9kZS5sZW5ndGg7IGsrKykge1xuICAgICAgICBwcm9iICs9IHBhcnNlSW50KGJhc2VOb2RlW2tdLmdldEF0dHJpYnV0ZShcInByb2JhYmlsaXR5XCIpKTtcbiAgICAgICAgaWYgKHByb2IgPj0gcmFuZCkge1xuICAgICAgICAgIGluZGV4ID0gaztcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgZm9yIChrID0gMDsgayA8IGNoaWxkcy5sZW5ndGg7IGsrKykge1xuICAgICAgICBpZiAoY2hpbGRzW2tdLmdldEF0dHJpYnV0ZShcImlkXCIpID09IGJhc2VOb2RlW2luZGV4XS50ZXh0Q29udGVudCkge1xuICAgICAgICAgIHRoaXMuYW5pbWF0aW9uSWQgPSBjaGlsZHNba10uZ2V0QXR0cmlidXRlKFwiaWRcIik7XG4gICAgICAgICAgdGhpcy5hbmltYXRpb25TdGVwID0gMDtcbiAgICAgICAgICB0aGlzLmFuaW1hdGlvbk5vZGUgPSBjaGlsZHNba107XG4gICAgICAgICAgbm9kZUZvdW5kID0gdHJ1ZTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAobm9kZUZvdW5kKSAvLyBjcmVhdGUgQ2hpbGQsIGlmIHByZXNlbnRcbiAgICAgICAge1xuICAgICAgICAgIHZhciBjaGlsZHNSb290ID0gdGhpcy54bWxEb2MuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2NoaWxkcycpWzBdO1xuICAgICAgICAgIHZhciBjaGlsZHMgPSBjaGlsZHNSb290LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdjaGlsZCcpO1xuICAgICAgICAgIGZvciAoayA9IDA7IGsgPCBjaGlsZHMubGVuZ3RoOyBrKyspIHtcbiAgICAgICAgICAgIGlmIChjaGlsZHNba10uZ2V0QXR0cmlidXRlKFwiYW5pbWF0aW9uaWRcIikgPT0gdGhpcy5hbmltYXRpb25JZCkge1xuICAgICAgICAgICAgICBpZiAoQUNUSVZBVEVfREVCVUcpIGNvbnNvbGUubG9nKFwiQ2hpbGQgZnJvbSBBbmltYXRpb25cIik7XG4gICAgICAgICAgICAgIHZhciBlU2hlZXBDaGlsZCA9IG5ldyBlU2hlZXAobnVsbCwgdHJ1ZSk7XG4gICAgICAgICAgICAgIGVTaGVlcENoaWxkLmFuaW1hdGlvbklkID0gY2hpbGRzW2tdLmdldEVsZW1lbnRzQnlUYWdOYW1lKCduZXh0JylbMF0udGV4dENvbnRlbnQ7XG4gICAgICAgICAgICAgIHZhciB4ID0gY2hpbGRzW2tdLmdldEVsZW1lbnRzQnlUYWdOYW1lKCd4JylbMF0udGV4dENvbnRlbnQ7IC8vXG4gICAgICAgICAgICAgIHZhciB5ID0gY2hpbGRzW2tdLmdldEVsZW1lbnRzQnlUYWdOYW1lKCd5JylbMF0udGV4dENvbnRlbnQ7XG4gICAgICAgICAgICAgIGVTaGVlcENoaWxkLl9zZXRQb3NpdGlvbih0aGlzLl9wYXJzZUtleVdvcmRzKHgpLCB0aGlzLl9wYXJzZUtleVdvcmRzKHkpLCB0cnVlKTtcbiAgICAgICAgICAgICAgZVNoZWVwQ2hpbGQuU3RhcnQodGhpcy5hbmltYXRpb25GaWxlKTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgIHJldHVybiBub2RlRm91bmQ7XG4gICAgfVxuXG4gICAgLypcbiAgICAgKiBDaGVjayBpZiBzaGVlcCBpcyB3YWxraW5nIG92ZXIgYSBkZWZpbmVkIEhUTUwgVEFHLWVsZW1lbnRcbiAgICAgKi9cblxuICB9LCB7XG4gICAga2V5OiBcIl9jaGVja092ZXJsYXBwaW5nXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIF9jaGVja092ZXJsYXBwaW5nKCkge1xuICAgICAgdmFyIHggPSB0aGlzLmltYWdlWDtcbiAgICAgIHZhciB5ID0gdGhpcy5pbWFnZVkgKyB0aGlzLmltYWdlSDtcbiAgICAgIHZhciByZWN0O1xuICAgICAgdmFyIG1hcmdpbiA9IDIwO1xuICAgICAgaWYgKHRoaXMuSFRNTGVsZW1lbnQpIG1hcmdpbiA9IDU7XG4gICAgICBmb3IgKHZhciBpbmRleCBpbiBDT0xMSVNJT05fV0lUSCkge1xuICAgICAgICB2YXIgZWxzID0gZG9jdW1lbnQuYm9keS5nZXRFbGVtZW50c0J5VGFnTmFtZShDT0xMSVNJT05fV0lUSFtpbmRleF0pO1xuXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZWxzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgcmVjdCA9IGVsc1tpXS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcblxuICAgICAgICAgIGlmICh5ID4gcmVjdC50b3AgLSAyICYmIHkgPCByZWN0LnRvcCArIG1hcmdpbikge1xuICAgICAgICAgICAgaWYgKHggPiByZWN0LmxlZnQgJiYgeCA8IHJlY3QucmlnaHQgLSB0aGlzLmltYWdlVykge1xuICAgICAgICAgICAgICB2YXIgc3R5bGUgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShlbHNbaV0pO1xuICAgICAgICAgICAgICBpZiAoc3R5bGUuYm9yZGVyVG9wU3R5bGUgIT0gXCJcIiAmJiBzdHlsZS5ib3JkZXJUb3BTdHlsZSAhPSBcIm5vbmVcIiAmJiBzdHlsZS5kaXNwbGF5ICE9IFwibm9uZVwiKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGVsc1tpXTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIC8qXG4gICAgICogVHJ5IHRvIGdldCB0aGUgdmFsdWUgb2YgYSBub2RlIChmcm9tIHRoZSBjdXJyZW50IGFuaW1hdGlvbk5vZGUpLCBpZiBpdCBpcyBub3QgcG9zc2libGUgcmV0dXJucyB0aGUgZGVmYXVsdFZhbHVlXG4gICAgICovXG5cbiAgfSwge1xuICAgIGtleTogXCJfZ2V0Tm9kZVZhbHVlXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIF9nZXROb2RlVmFsdWUobm9kZU5hbWUsIHZhbHVlTmFtZSwgZGVmYXVsdFZhbHVlKSB7XG4gICAgICBpZiAoIXRoaXMuYW5pbWF0aW9uTm9kZSB8fCAhdGhpcy5hbmltYXRpb25Ob2RlLmdldEVsZW1lbnRzQnlUYWdOYW1lKG5vZGVOYW1lKSkgcmV0dXJuO1xuICAgICAgaWYgKHRoaXMuYW5pbWF0aW9uTm9kZS5nZXRFbGVtZW50c0J5VGFnTmFtZShub2RlTmFtZSlbMF0uZ2V0RWxlbWVudHNCeVRhZ05hbWUodmFsdWVOYW1lKVswXSkge1xuICAgICAgICB2YXIgdmFsdWUgPSB0aGlzLmFuaW1hdGlvbk5vZGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUobm9kZU5hbWUpWzBdLmdldEVsZW1lbnRzQnlUYWdOYW1lKHZhbHVlTmFtZSlbMF0udGV4dENvbnRlbnQ7XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuX3BhcnNlS2V5V29yZHModmFsdWUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGRlZmF1bHRWYWx1ZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKlxuICAgICAqIE5leHQgc3RlcCAoZWFjaCBmcmFtZSBpcyBhIHN0ZXApXG4gICAgICovXG5cbiAgfSwge1xuICAgIGtleTogXCJfbmV4dEVTaGVlcFN0ZXBcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gX25leHRFU2hlZXBTdGVwKCkge1xuICAgICAgaWYgKHRoaXMucHJlcGFyZVRvRGllKSByZXR1cm47XG5cbiAgICAgIHZhciB4MSA9IHRoaXMuX2dldE5vZGVWYWx1ZSgnc3RhcnQnLCAneCcsIDApO1xuICAgICAgdmFyIHkxID0gdGhpcy5fZ2V0Tm9kZVZhbHVlKCdzdGFydCcsICd5JywgMCk7XG4gICAgICB2YXIgb2ZmMSA9IHRoaXMuX2dldE5vZGVWYWx1ZSgnc3RhcnQnLCAnb2Zmc2V0eScsIDApO1xuICAgICAgdmFyIG9wYTEgPSB0aGlzLl9nZXROb2RlVmFsdWUoJ3N0YXJ0JywgJ29wYWNpdHknLCAxKTtcbiAgICAgIHZhciBkZWwxID0gdGhpcy5fZ2V0Tm9kZVZhbHVlKCdzdGFydCcsICdpbnRlcnZhbCcsIDEwMDApO1xuICAgICAgdmFyIHgyID0gdGhpcy5fZ2V0Tm9kZVZhbHVlKCdlbmQnLCAneCcsIDApO1xuICAgICAgdmFyIHkyID0gdGhpcy5fZ2V0Tm9kZVZhbHVlKCdlbmQnLCAneScsIDApO1xuICAgICAgdmFyIG9mZjIgPSB0aGlzLl9nZXROb2RlVmFsdWUoJ2VuZCcsICdvZmZzZXR5JywgMCk7XG4gICAgICB2YXIgb3BhMiA9IHRoaXMuX2dldE5vZGVWYWx1ZSgnZW5kJywgJ2ludGVydmFsJywgMSk7XG4gICAgICB2YXIgZGVsMiA9IHRoaXMuX2dldE5vZGVWYWx1ZSgnZW5kJywgJ2ludGVydmFsJywgMTAwMCk7XG5cbiAgICAgIHZhciByZXBlYXQgPSB0aGlzLl9wYXJzZUtleVdvcmRzKHRoaXMuYW5pbWF0aW9uTm9kZS5nZXRFbGVtZW50c0J5VGFnTmFtZSgnc2VxdWVuY2UnKVswXS5nZXRBdHRyaWJ1dGUoJ3JlcGVhdCcpKTtcbiAgICAgIHZhciByZXBlYXRmcm9tID0gdGhpcy5hbmltYXRpb25Ob2RlLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdzZXF1ZW5jZScpWzBdLmdldEF0dHJpYnV0ZSgncmVwZWF0ZnJvbScpO1xuICAgICAgdmFyIGdyYXZpdHkgPSB0aGlzLmFuaW1hdGlvbk5vZGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2dyYXZpdHknKTtcbiAgICAgIHZhciBib3JkZXIgPSB0aGlzLmFuaW1hdGlvbk5vZGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2JvcmRlcicpO1xuXG4gICAgICB2YXIgc3RlcHMgPSB0aGlzLmFuaW1hdGlvbk5vZGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2ZyYW1lJykubGVuZ3RoICsgKHRoaXMuYW5pbWF0aW9uTm9kZS5nZXRFbGVtZW50c0J5VGFnTmFtZSgnZnJhbWUnKS5sZW5ndGggLSByZXBlYXRmcm9tKSAqIHJlcGVhdDtcblxuICAgICAgdmFyIGluZGV4O1xuXG4gICAgICBpZiAodGhpcy5hbmltYXRpb25TdGVwIDwgdGhpcy5hbmltYXRpb25Ob2RlLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdmcmFtZScpLmxlbmd0aCkgaW5kZXggPSB0aGlzLmFuaW1hdGlvbk5vZGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2ZyYW1lJylbdGhpcy5hbmltYXRpb25TdGVwXS50ZXh0Q29udGVudDtlbHNlIGlmIChyZXBlYXRmcm9tID09IDApIGluZGV4ID0gdGhpcy5hbmltYXRpb25Ob2RlLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdmcmFtZScpW3RoaXMuYW5pbWF0aW9uU3RlcCAlIHRoaXMuYW5pbWF0aW9uTm9kZS5nZXRFbGVtZW50c0J5VGFnTmFtZSgnZnJhbWUnKS5sZW5ndGhdLnRleHRDb250ZW50O2Vsc2UgaW5kZXggPSB0aGlzLmFuaW1hdGlvbk5vZGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2ZyYW1lJylbcGFyc2VJbnQocmVwZWF0ZnJvbSkgKyBwYXJzZUludCgodGhpcy5hbmltYXRpb25TdGVwIC0gcmVwZWF0ZnJvbSkgJSAodGhpcy5hbmltYXRpb25Ob2RlLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdmcmFtZScpLmxlbmd0aCAtIHJlcGVhdGZyb20pKV0udGV4dENvbnRlbnQ7XG5cbiAgICAgIHRoaXMuRE9NaW1nLnN0eWxlLmxlZnQgPSAtdGhpcy5pbWFnZVcgKiAoaW5kZXggJSB0aGlzLnRpbGVzWCkgKyBcInB4XCI7XG4gICAgICB0aGlzLkRPTWltZy5zdHlsZS50b3AgPSAtdGhpcy5pbWFnZUggKiBwYXJzZUludChpbmRleCAvIHRoaXMudGlsZXNYKSArIFwicHhcIjtcblxuICAgICAgaWYgKHRoaXMuZHJhZ2dpbmcgfHwgdGhpcy5pbmZvYm94KSB7XG4gICAgICAgIHRoaXMuYW5pbWF0aW9uU3RlcCsrO1xuICAgICAgICBzZXRUaW1lb3V0KHRoaXMuX25leHRFU2hlZXBTdGVwLmJpbmQodGhpcyksIDUwKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5mbGlwcGVkKSB7XG4gICAgICAgIHgxID0gLXgxO1xuICAgICAgICB4MiA9IC14MjtcbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMuYW5pbWF0aW9uU3RlcCA9PSAwKSB0aGlzLl9zZXRQb3NpdGlvbih4MSwgeTEsIGZhbHNlKTtlbHNlIHRoaXMuX3NldFBvc2l0aW9uKHBhcnNlSW50KHgxKSArIHBhcnNlSW50KCh4MiAtIHgxKSAqIHRoaXMuYW5pbWF0aW9uU3RlcCAvIHN0ZXBzKSwgcGFyc2VJbnQoeTEpICsgcGFyc2VJbnQoKHkyIC0geTEpICogdGhpcy5hbmltYXRpb25TdGVwIC8gc3RlcHMpLCBmYWxzZSk7XG5cbiAgICAgIHRoaXMuYW5pbWF0aW9uU3RlcCsrO1xuXG4gICAgICBpZiAodGhpcy5hbmltYXRpb25TdGVwID49IHN0ZXBzKSB7XG4gICAgICAgIGlmICh0aGlzLmFuaW1hdGlvbk5vZGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2FjdGlvbicpWzBdKSB7XG4gICAgICAgICAgc3dpdGNoICh0aGlzLmFuaW1hdGlvbk5vZGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2FjdGlvbicpWzBdLnRleHRDb250ZW50KSB7XG4gICAgICAgICAgICBjYXNlIFwiZmxpcFwiOlxuICAgICAgICAgICAgICBpZiAodGhpcy5ET01kaXYuc3R5bGUudHJhbnNmb3JtID09IFwicm90YXRlWSgwZGVnKVwiKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ET01kaXYuc3R5bGUudHJhbnNmb3JtID0gXCJyb3RhdGVZKDE4MGRlZylcIjtcbiAgICAgICAgICAgICAgICB0aGlzLmZsaXBwZWQgPSB0cnVlO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuRE9NZGl2LnN0eWxlLnRyYW5zZm9ybSA9IFwicm90YXRlWSgwZGVnKVwiO1xuICAgICAgICAgICAgICAgIHRoaXMuZmxpcHBlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcblxuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF0aGlzLl9nZXROZXh0UmFuZG9tTm9kZSh0aGlzLmFuaW1hdGlvbk5vZGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3NlcXVlbmNlJylbMF0pKSByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHZhciBzZXROZXh0ID0gZmFsc2U7XG5cbiAgICAgIGlmIChib3JkZXIgJiYgYm9yZGVyWzBdICYmIGJvcmRlclswXS5nZXRFbGVtZW50c0J5VGFnTmFtZSgnbmV4dCcpKSB7XG4gICAgICAgIGlmICh4MiA8IDAgJiYgdGhpcy5pbWFnZVggPCAwKSB7XG4gICAgICAgICAgdGhpcy5pbWFnZVggPSAwO1xuICAgICAgICAgIHNldE5leHQgPSB0cnVlO1xuICAgICAgICB9IGVsc2UgaWYgKHgyID4gMCAmJiB0aGlzLmltYWdlWCA+IHRoaXMuc2NyZWVuVyAtIHRoaXMuaW1hZ2VXKSB7XG4gICAgICAgICAgdGhpcy5pbWFnZVggPSB0aGlzLnNjcmVlblcgLSB0aGlzLmltYWdlVztcbiAgICAgICAgICB0aGlzLkRPTWRpdi5zdHlsZS5sZWZ0ID0gcGFyc2VJbnQodGhpcy5pbWFnZVgpICsgXCJweFwiO1xuICAgICAgICAgIHNldE5leHQgPSB0cnVlO1xuICAgICAgICB9IGVsc2UgaWYgKHkyIDwgMCAmJiB0aGlzLmltYWdlWSA8IDApIHtcbiAgICAgICAgICB0aGlzLmltYWdlWSA9IDA7XG4gICAgICAgICAgc2V0TmV4dCA9IHRydWU7XG4gICAgICAgIH0gZWxzZSBpZiAoeTIgPiAwICYmIHRoaXMuaW1hZ2VZID4gdGhpcy5zY3JlZW5IIC0gdGhpcy5pbWFnZUgpIHtcbiAgICAgICAgICB0aGlzLmltYWdlWSA9IHRoaXMuc2NyZWVuSCAtIHRoaXMuaW1hZ2VIO1xuICAgICAgICAgIHNldE5leHQgPSB0cnVlO1xuICAgICAgICB9IGVsc2UgaWYgKHkyID4gMCkge1xuICAgICAgICAgIGlmICh0aGlzLl9jaGVja092ZXJsYXBwaW5nKCkpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmltYWdlWSA+IHRoaXMuaW1hZ2VIKSB7XG4gICAgICAgICAgICAgIHRoaXMuSFRNTGVsZW1lbnQgPSB0aGlzLl9jaGVja092ZXJsYXBwaW5nKCk7XG4gICAgICAgICAgICAgIHRoaXMuaW1hZ2VZID0gTWF0aC5jZWlsKHRoaXMuSFRNTGVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkudG9wKSAtIHRoaXMuaW1hZ2VIO1xuICAgICAgICAgICAgICBzZXROZXh0ID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5IVE1MZWxlbWVudCkge1xuICAgICAgICAgIGlmICghdGhpcy5fY2hlY2tPdmVybGFwcGluZygpKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5pbWFnZVkgKyB0aGlzLmltYWdlSCA+IHRoaXMuSFRNTGVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkudG9wICsgMyB8fCB0aGlzLmltYWdlWSArIHRoaXMuaW1hZ2VIIDwgdGhpcy5IVE1MZWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS50b3AgLSAzKSB7XG4gICAgICAgICAgICAgIHRoaXMuSFRNTGVsZW1lbnQgPSBudWxsO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmltYWdlWCA8IHRoaXMuSFRNTGVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkubGVmdCkge1xuICAgICAgICAgICAgICB0aGlzLmltYWdlWCA9IHBhcnNlSW50KHRoaXMuaW1hZ2VYICsgMyk7XG4gICAgICAgICAgICAgIHNldE5leHQgPSB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgdGhpcy5pbWFnZVggPSBwYXJzZUludCh0aGlzLmltYWdlWCAtIDMpO1xuICAgICAgICAgICAgICBzZXROZXh0ID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuRE9NZGl2LnN0eWxlLmxlZnQgPSBwYXJzZUludCh0aGlzLmltYWdlWCkgKyBcInB4XCI7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChzZXROZXh0KSB7XG4gICAgICAgICAgaWYgKCF0aGlzLl9nZXROZXh0UmFuZG9tTm9kZShib3JkZXJbMF0pKSByZXR1cm47XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmICghc2V0TmV4dCAmJiBncmF2aXR5ICYmIGdyYXZpdHlbMF0gJiYgZ3Jhdml0eVswXS5nZXRFbGVtZW50c0J5VGFnTmFtZSgnbmV4dCcpKSB7XG4gICAgICAgIGlmICh0aGlzLmltYWdlWSA8IHRoaXMuc2NyZWVuSCAtIHRoaXMuaW1hZ2VIIC0gMikge1xuICAgICAgICAgIGlmICh0aGlzLkhUTUxlbGVtZW50ID09IG51bGwpIHtcbiAgICAgICAgICAgIHNldE5leHQgPSB0cnVlO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuX2NoZWNrT3ZlcmxhcHBpbmcoKSkge1xuICAgICAgICAgICAgICBzZXROZXh0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgdGhpcy5IVE1MZWxlbWVudCA9IG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKHNldE5leHQpIHtcbiAgICAgICAgICAgIGlmICghdGhpcy5fZ2V0TmV4dFJhbmRvbU5vZGUoZ3Jhdml0eVswXSkpIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmICghc2V0TmV4dCkge1xuICAgICAgICBpZiAodGhpcy5pbWFnZVggPCAtdGhpcy5pbWFnZVcgJiYgeDIgPCAwIHx8IHRoaXMuaW1hZ2VYID4gdGhpcy5zY3JlZW5XICYmIHgyID4gMCB8fCB0aGlzLmltYWdlWSA8IC10aGlzLmltYWdlSCAmJiB5MSA8IDAgfHwgdGhpcy5pbWFnZVkgPiB0aGlzLnNjcmVlbkggJiYgeTIgPiAwKSB7XG4gICAgICAgICAgc2V0TmV4dCA9IHRydWU7XG4gICAgICAgICAgaWYgKCF0aGlzLmlzQ2hpbGQpIHtcbiAgICAgICAgICAgIHRoaXMuX3NwYXduRVNoZWVwKCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBzZXRUaW1lb3V0KHRoaXMuX25leHRFU2hlZXBTdGVwLmJpbmQodGhpcyksIHBhcnNlSW50KGRlbDEpICsgcGFyc2VJbnQoKGRlbDIgLSBkZWwxKSAqIHRoaXMuYW5pbWF0aW9uU3RlcCAvIHN0ZXBzKSk7XG4gICAgfVxuXG4gICAgLypcbiAgICAgKiBMb2FkIFBldCBMaXN0IGZyb20gR2l0SHViLCBzbyB1c2VyIGNhbiBjaGFuZ2UgaXRcbiAgICAgKi9cblxuICB9LCB7XG4gICAga2V5OiBcIl9sb2FkUGV0TGlzdFwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBfbG9hZFBldExpc3QoZWxlbWVudCkge1xuICAgICAgdmFyIF90aGlzMyA9IHRoaXM7XG5cbiAgICAgIGZldGNoKFwiaHR0cHM6Ly9hZHJpYW5vdGlnZXIuZ2l0aHViLmlvL3dlYi1lc2hlZXAvcGV0cy9wZXRzLmpzb25cIiwge1xuICAgICAgICBjcmVkZW50aWFsczogJ3NhbWUtb3JpZ2luJyxcbiAgICAgICAgY2FjaGU6IFwiZm9yY2UtY2FjaGVcIlxuICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTtcbiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKGpzb24pIHtcbiAgICAgICAgY29uc29sZS5sb2coanNvbik7XG4gICAgICAgIGlmIChqc29uLnBldHMpIHtcbiAgICAgICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZXVwXCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuXG4gICAgICAgICAgICB2YXIgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgICAgICAgIGRpdi5zZXRBdHRyaWJ1dGUoXCJzdHlsZVwiLCBcInBvc2l0aW9uOmFic29sdXRlO2xlZnQ6MHB4O3RvcDoyMHB4O3dpZHRoOjE4M3B4O2hlaWdodDoxMDAlO21pbi1oZWlnaHQ6ODBweDtiYWNrZ3JvdW5kOmxpbmVhci1ncmFkaWVudCh0byBib3R0b20sICM4MDgwZmYsICMzMDMwYTEpO2NvbG9yOnllbGxvdztcIik7XG4gICAgICAgICAgICBlbGVtZW50LnBhcmVudE5vZGUuYXBwZW5kQ2hpbGQoZGl2KTtcblxuICAgICAgICAgICAgdmFyIF9sb29wID0gZnVuY3Rpb24gX2xvb3Aoaykge1xuICAgICAgICAgICAgICBwZXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYlwiKTtcblxuICAgICAgICAgICAgICBwZXQuc2V0QXR0cmlidXRlKFwic3R5bGVcIiwgXCJjdXJzb3I6cG9pbnRlcjtkaXNwbGF5OmJsb2NrO1wiKTtcbiAgICAgICAgICAgICAgcGV0LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGpzb24ucGV0c1trXS5uYW1lKSk7XG4gICAgICAgICAgICAgIHBldC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciB4ID0gbmV3IGVTaGVlcChfdGhpczMudXNlck9wdGlvbnMpO1xuICAgICAgICAgICAgICAgIHguU3RhcnQoXCJodHRwczovL2Fkcmlhbm90aWdlci5naXRodWIuaW8vd2ViLWVzaGVlcC9wZXRzL1wiICsganNvbi5wZXRzW2tdLmZpbGUpO1xuICAgICAgICAgICAgICAgIF90aGlzMy5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIGRpdi5hcHBlbmRDaGlsZChwZXQpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgZm9yICh2YXIgayBpbiBqc29uLnBldHMpIHtcbiAgICAgICAgICAgICAgdmFyIHBldDtcblxuICAgICAgICAgICAgICBfbG9vcChrKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZGl2LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICBlbGVtZW50LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZGl2KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH1dKTtcblxuICByZXR1cm4gZVNoZWVwO1xufSgpO1xuXG47Il19
